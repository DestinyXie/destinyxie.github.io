var HEAD,BODY,BODYFS,DOC=document,WIN=window,Mix={isAndroid:/android/gi.test(navigator.appVersion),isIDevice:/iphone|ipad/gi.test(navigator.appVersion)};
(function(){function a(a){if(c==="")return a;a=a.charAt(0).toUpperCase()+a.substr(1);return c+a}var b=DOC.createElement("div").style,c=function(){for(var a="t,webkitT,MozT,msT,OT".split(","),c,g=0,h=a.length;g<h;g++)if(c=a[g]+"ransform",c in b)return a[g].substr(0,a[g].length-1);return!1}();Mix.cssPrefix=c?"-"+c.toLowerCase()+"-":"";Mix.transform=a("transform");Mix.transformOrigin=a("transformOrigin");Mix.transitionProperty=a("transitionProperty");Mix.transitionDuration=a("transitionDuration");Mix.transitionTimingFunction=
a("transitionTimingFunction");Mix.transitionDelay=a("transitionDelay");Mix.has3d=a("perspective")in b;Mix.hasTouch="ontouchstart"in WIN;Mix.hasTransform=!!c;Mix.hasTransitionEnd=a("transition")in b;Mix.nextFrame=function(){return WIN.requestAnimationFrame||WIN[c+"RequestAnimationFrame"]||function(a){return setTimeout(a,1)}}();Mix.cancelFrame=WIN.cancelRequestAnimationFrame||WIN.webkitCancelAnimationFrame||WIN[c+"CancelRequestAnimationFrame"]||clearTimeout;Mix.cssVender=c;c=b=null})();
var START_EV=Mix.hasTouch?"touchstart":"mousedown",MOVE_EV=Mix.hasTouch?"touchmove":"mousemove",END_EV=Mix.hasTouch?"touchend":"mouseup",CLICK_EV=Mix.hasTouch?"touchend":"click",CANCEL_EV=Mix.hasTouch?"touchcancel":"mouseup",WHEEL_EV=Mix.cssVender=="Moz"?"DOMMouseScroll":"mousewheel",RESIZE_EV="resize";TRNEND_EV=function(){if(Mix.cssVender===!1)return!1;return{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[Mix.cssVender]}();
Mix.translateZ=Mix.has3d?" translateZ(0)":"";function extend(a,b,c){var d;if(c){for(d in b)c.hasOwnProperty(d)||b.hasOwnProperty(d)&&(a[d]=typeof b[d]=="object"&&b[d]!==null&&!b[d].nodeType&&!(b[d]instanceof Array)?extend({},b[d]):b[d]);a=extend(a,c)}else for(d in b)b.hasOwnProperty(d)&&(a[d]=typeof b[d]=="object"&&b[d]!==null&&!b[d].nodeType&&!(b[d]instanceof Array)?extend({},b[d]):b[d]);return a}
extend(Array.prototype,{has:function(a){return this.indexOf(a)!==-1},remove:function(a){if(!this.has(a))return this;this.splice(this.indexOf(a),1);return this},clone:function(){return this.slice(0)}});if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[　\s\t\n]*|[　\s\t\n]*$/g,"")};String.prototype.chineseLen=function(){for(var a=0,b=0;b<this.length;b++)a+=this.charAt(b).charCodeAt()>255?1:0.5;return Math.abs(Math.ceil(a))};
$$=DOC.querySelectorAll?function(a,b){b=b||DOC;return b.querySelectorAll(a,b)}:function(){alert("querySelectorAll not implemented")};$=DOC.querySelector?function(a,b){b=b||DOC;return b.querySelector(a,b)}:function(a,b){var c=$$(a,b);return c.length>0?c[0]:null};
(function(){var a=Object.prototype.toString;extend($,{each:function(a,c){if(a&&c){a.nodeType&&(a=[a]);for(var d=a.length;d--;)c(a[d],d)}},isFunc:function(b){return a.call(b)==="[object Function]"},isStr:function(b){return a.call(b)==="[object String]"},isArray:function(b){return a.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||a.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return!1;try{if(b.constructor&&!hasOwnProperty.call(b,"constructor")&&!hasOwnProperty.call(b.constructor.prototype,
"isPrototypeOf"))return!1}catch(c){return!1}for(var d in b);return d===void 0||hasOwnProperty.call(b,d)}})})();var Event=function(a){if(!a)return null;if(a.stop)return a;this.event=a;for(var b=a.changedTouches,a=b&&b.length>0?b[0]:a,b=["pageX","pageY","target"],c=b.length;c--;)this[b[c]]=a[b[c]]};
Event.prototype={stop:function(){if(e=this.event)e.preventDefault(),e.stopPropagation()},getTargets:function(a){var b=[],c=this.target;[DOC,BODY].has(c)||(b=DOM.findParent(c,a),1==c.nodeType&&b.unshift(c));return b}};
var DOM={create:function(a,b){var c=DOC.createElement(a);b&&(b.style&&(DOM.setStyles(c,b.style),delete b.style),extend(c,b));return c},remove:function(a){a.parentNode.removeChild(a)},findParent:function(a,b,c){var d=[];if(b)for(var f=$$(b),g=[],h=f.length;h--;)g.push(f[h]);for(;a=a.parentNode;){if([DOC,BODY].has(a))break;if(1==a.nodeType&&(!b||g&&g.has(a))){if(c)return a;d.push(a)}}return d},setStyles:function(a,b){var c="",d,f;for(f in b)d=b[f],d!==""&&!isNaN(d)&&f!=="zoom"&&f!=="z-index"&&(d+="px"),
c+=f+":"+d+";";a.style.cssText+=c},getSize:function(a){return[parseInt(getComputedStyle(a).width),parseInt(getComputedStyle(a).height)]},offset:function(a,b){for(var b=b||BODY,c=a.offsetLeft,d=a.offsetTop,f=a.offsetParent;f&&f!=b&&f!=BODY;)c+=f.offsetLeft,d+=f.offsetTop,f=f.offsetParent;return{left:c,top:d}},hasClass:function(a,b){return a.className.split(/\s+/).has(b)},addClass:function(a,b){$.each(a,function(c){var d=c.className;DOM.hasClass(a,b)||(c.className+=(d?" ":"")+b)})},removeClass:function(a,
b){$.each(a,function(a){var d=a.className.split(/\s+/);b&&d.has(b)&&d.splice(d.indexOf(b),1);a.className=d.join(" ")})},contains:function(a,b){for(;b;){if(b==a)return!0;b=b.parentNode}return!1},addEvent:DOC.addEventListener?function(a,b,c,d){a.addEventListener(b,c,!!d)}:function(a,b,c){a.attachEvent("on"+b,c)},removeEvent:DOC.removeEventListener?function(a,b,c,d){a.removeEventListener(b,c,!!d)}:function(a,b,c){a.detachEvent("on"+b,c)},fireClick:function(a,b){var c=DOC.createEvent("MouseEvents");c.initEvent(b||
"click");a.dispatchEvent(c)},loadJs:function(a,b){var c=DOC.createElement("script");c.src=a;HEAD.appendChild(c);c.onload=function(){HEAD.removeChild(c);b&&b()}},loadCss:function(a,b){var c=DOC.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=a;HEAD.appendChild(c);c.onload=function(){b&&b()}}},Delegate={longTapTime:1500,longTapInter:null,init:function(){DOM.addEvent(DOC,START_EV,Delegate.start)},start:function(a){Delegate.startEvent&&Delegate.end(a);var b=new Event(a),c=b.getTargets();
Delegate.startEvent=a;Delegate.isClick=!0;Delegate.startPoint=[b.pageX,b.pageY];Delegate.targets=[];Delegate.startTime=a.timeStamp||Date.now();Delegate.hasLongTap=!1;Delegate.hasMoveFn=!1;for(var d=c.length,f;d--;)if(f=c[d],f.getAttribute("_click")||f.getAttribute("_longTap")||f.getAttribute("_move")||["A","INPUT"].has(f.nodeName)){Delegate.targets.unshift(f);if(f.getAttribute("_longTap"))Delegate.hasLongTap=!0,f.event=a;if(f.getAttribute("_move"))Delegate.hasMoveFn=!0,Delegate.moveDom=f,Delegate.moveDom.moveName=
Delegate.moveDom.getAttribute("_move"),Delegate.moveDom.originPos=[parseInt(getComputedStyle(f).left),parseInt(getComputedStyle(f).top)],Delegate.moveDom.event=a,b.stop()}Delegate.targets.length>0&&(DOM.addClass(Delegate.targets[0],"active"),DOM.addEvent(DOC,MOVE_EV,Delegate.move),DOM.addEvent(DOC,END_EV,Delegate.end));if(!Delegate.hasMoveFn&&Delegate.hasLongTap)Delegate.longTapInter=setTimeout(function(){Delegate.longTap()},Delegate.longTapTime)},move:function(a){if(Delegate.startEvent){var b=new Event(a),
c=Delegate.startPoint,b=[b.pageX,b.pageY],d=Mix.base.calculPy(b[0]-c[0],b[1]-c[1]);if(Delegate.hasMoveFn)Delegate.moveDom.moveDist=[b[0]-c[0],b[1]-c[1]],Mix.obs.publish(Delegate.moveDom.moveName,Delegate.moveDom);else if(d>15)Delegate.isClick=!1,Delegate.removeHover(),Delegate.targets=[],Delegate.end(a)}},removeHover:function(){Delegate.targets.forEach(function(a){DOM.removeClass(a,"active")})},longTap:function(){for(var a=Delegate.targets,b=a.length,c;b--;)if(c=a[b],fnAttr=c.getAttribute("_longTap"))(new Function(fnAttr)).call(c),
Delegate.isClick=!1,Delegate.end(c.event)},end:function(a){Delegate.hasLongTap&&clearTimeout(Delegate.longTapInter);Delegate.removeHover();var b=Delegate.targets;if(b.length>0&&Delegate.isClick){var b=b[0],c=b.getAttribute("_click");if(c)b.event=a,(new Function(c)).call(b)}Delegate.hasMoveFn&&Mix.obs.publish(Delegate.moveDom.moveName+"_end",Delegate.moveDom);DOM.removeEvent(DOC,MOVE_EV,Delegate.move);DOM.removeEvent(DOC,END_EV,Delegate.end);Delegate.isClick=!1;Delegate.startEvent=null;Delegate.startPoint=
[0,0];Delegate.targets=[];Delegate.startTime=null;Delegate.hasLongTap=!1;Delegate.hasMoveFn=!1}};Delegate.init();Mix.obs={};
(function(a){function b(a){return function(){throw a;}}function c(a,c){if(!d.hasOwnProperty(a))return!1;setTimeout(function(){for(var f=d[a],j=0,k=f.length;j<k;j++)try{f[j].func(a,c)}catch(n){setTimeout(b(n),Mix.isAndroid?200:0)}},0);return!0}var d={},f=-1;a.publish=function(a,b){return c(a,b)};a.subscribe=function(a,b){d.hasOwnProperty(a)||(d[a]=[]);var c=(++f).toString();d[a].push({token:c,func:b});return c};a.unsubscribe=function(a){for(var b in d)if(d.hasOwnProperty(b))for(var c=0,f=d[b].length;c<
f;c++)if(d[b][c].token===a)return d[b].splice(c,1),a;return!1};a.clear=function(a){a?d[a]=[]:(d={},f=-1)}})(Mix.obs);
Mix.base={sameObj:function(a,b,c){if(!a||!b||JSON.stringify(a).length!=JSON.stringify(b).length)return!1;for(var d in a)if(a.hasOwnProperty(d)&&JSON.stringify(a[d])!=JSON.stringify(b[d])&&(!c||!c.has(d)))return!1;return!0},calculPy:function(a,b){return Math.sqrt(Math.pow(a,2)+Math.pow(b,2))},insertAtCaret:function(a,b){var c=a.nodeType==1?a:$(a);if(c.setSelectionRange){var d=c.selectionStart,f=c.selectionEnd,g=c.value.substring(0,d),f=c.value.substring(f);c.value=g+b+f;c.focus();g=b.length;c.setSelectionRange(d+
g,d+g);c.focus()}else document.all&&c.createTextRange&&c.caretPos?(c=c.caretPos,c.text=c.text.charAt(c.text.length-1)==""?b+"":b):c.value+=b},cookie:function(a,b,c){var d=document.cookie,f,g;if(b===null||b==""){d=new Date;f=Mix.base.cookie(a);d.setTime(Date.now()-1);if(f)document.cookie=a+"="+escape(f)+";expires="+d.toGMTString();return!1}if(arguments.length>1)d=new Date,f=c||3E3,d.setTime(Date.now()+f*864E5),document.cookie=a+"="+escape(b)+";expires="+d.toGMTString();else if(d.length>0)if(f=d.indexOf(a+
"="),f!="-1"){f+=a.length+1;g=d.indexOf(";",f);if(g==-1)g=d.length;return unescape(d.substring(f,g))}else return!1;else return!1},cookieStor:{getItem:function(a){return Mix.base.cookie(a)},setItem:function(a,b){Mix.base.cookie(a,b)},removeItem:function(a){Mix.base.cookie(a,null)},clear:function(){var a=document.cookie,b;if(a.length>0&&(a=a.split(";"),a.length!=0))for(var c=a.length-1;c>=0;c--)b=a[c].split("=")[0],Tools.cookieStor.removeItem(b)}},storage:function(){function a(a){if(a&&a=="session")return sessionStorage||
Tools.cookieStor;return localStorage||Tools.cookieStor}return{get:function(b,c){var d=a(c).getItem(b);return/^(\{|\[).*(\}|\])$/.test(d)?JSON.parse(d):d},set:function(b,c,d){c=$.isArray(c)||$.isPlainObject(c)?JSON.stringify(c):c;a(d).setItem(b,c)},remove:function(b,c){a(c).removeItem(b)},clear:function(b){a(b).clear()}}}(),htmlEncode:function(a){return a?a.replace(/&(?!amp;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&#034;"):a},htmlDecode:function(a){return a?a.replace(/&#034;/g,
'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):a},htmlEncodeObj:function(a){for(key in a)a.hasOwnProperty(key)&&typeof a[key]=="string"&&(a[key]=Mix.base.htmlEncode(a[key]));return a},compiTpl:function(a,b,c,d){return a.replace(/\$\{([^\}]*)\}/g,function(a,g){if(g.match(/index:/))return d;if(g.match(/cb:/)&&c)return c(b,g.match(/cb:(.*)/));return b[g]||""})},logErr:function(a,b,c){a="error_type:"+(a.name||"undefined")+"|  error_message:"+(a.message||"undefined")+"| error_function:"+
b;c&&alert(a)}};
Mix.scroll=function(a,b){var c=this;c.wrapper=a.nodeType==1?a:$(a)||$("#"+a);c.wrapper.style.overflow="hidden";c.scroller=$(".scroller",c.wrapper)||c.wrapper.children[0];c.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!1,bounceLock:!1,momentum:!0,lockDirect:!0,useTransform:!0,useTransition:!1,topOffset:0,bottomOffset:0,hScrollbar:!1,vScrollbar:!1,fixedScrollbar:!1,hideScrollbar:Mix.isIDevice,fadeScrollbar:Mix.isIDevice&&Mix.has3d,onRefresh:null,onBeforeStart:null,onStart:null,onBreforeMove:null,onMove:null,
onMoveEnd:null,onBeforeEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null};extend(c.options,b);c.x=c.options.x;c.y=c.options.y;c.options.hScrollbar=c.options.hScroll&&c.options.hScrollbar;c.options.vScrollbar=c.options.vScroll&&c.options.vScrollbar;c.options.useTransform=Mix.hasTransform&&c.options.useTransform;c.options.useTransition=Mix.hasTransitionEnd&&c.options.useTransition;c.scroller.style.display="none";c.scroller.style[Mix.transitionProperty]=c.options.useTransform?Mix.cssPrefix+"transform":
"top left";c.scroller.style[Mix.transitionDuration]="0";c.scroller.style[Mix.transformOrigin]="0 0";c.options.useTransition&&(c.scroller.style[Mix.transitionTimingFunction]="cubic-bezier(0.33,0.66,0.66,1)");c.options.useTransform?c.scroller.style[Mix.transform]="translate("+c.x+"px,"+c.y+"px)"+Mix.translateZ:c.scroller.style.cssText+=";position:absolute;top:"+c.y+"px;left:"+c.x+"px";if(c.options.useTransition)c.options.fixedScrollbar=!0;c.scroller.style.display="block";c.refresh();Mix.obs.subscribe("resize",
function(){c._resize()});c._bind(START_EV)};Mix.scroll.stop=!1;
Mix.scroll.prototype={enabled:!0,x:0,y:0,steps:[],curPageX:0,curPageY:0,pagesX:[],pagesY:[],aniTime:null,handleEvent:function(a){switch(a.type){case START_EV:if(!Mix.hasTouch&&a.button!==0)break;this._start(a);break;case MOVE_EV:this._move(a);break;case END_EV:case CANCEL_EV:this._end(a);break;case WHEEL_EV:this._wheel(a);break;case TRNEND_EV:this._transitionEnd(a)}},_start:function(a){var b=new Event(a),c,d;if(this.enabled&&!Mix.scroll.stop){this._checkDOMChanges();Mix.scroll.stop=!0;["INPUT","TEXTAREA"].has(a.target.tagName)||
a.preventDefault();this.options.onBeforeStart&&this.options.onBeforeStart.call(this,a);this.options.useTransition&&this._transitionTime(0);this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;if(this.options.momentum&&(this.options.useTransform?(c=getComputedStyle(this.scroller,null)[Mix.transform].replace(/[^0-9\-.,]/g,"").split(","),d=+c[4],c=+c[5]):(d=+getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,""),c=+getComputedStyle(this.scroller,
null).top.replace(/[^0-9-]/g,"")),d!=this.x||c!=this.y))this.options.useTransition?this._unbind(TRNEND_EV):(Mix.cancelFrame.call(null,this.aniTime),this.aniTime=null),this.steps=[],this._pos(d,c),this.options.onScrollEnd&&this.options.onScrollEnd.call(this);this.absDistX=this.x;this.absDistY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=b.pageX;this.pointY=b.pageY;this.startTime=a.timeStamp||Date.now();this.options.onStart&&this.options.onStart.call(this,a);this._bind(MOVE_EV);this._bind(END_EV);
this._bind(CANCEL_EV)}},_move:function(a){var b=new Event(a),c=b.pageX-this.pointX,d=b.pageY-this.pointY,f=this.x+c,g=this.y+d,h=a.timeStamp||Date.now();if(Mix.scroll.outStop)this._end(a);else{this.options.onBreforeMove&&this.options.onBreforeMove.call(this,a);this.pointX=b.pageX;this.pointY=b.pageY;if(f>0||f<this.maxScrollX)f=this.options.bounce?this.x+c/2:f>=0||this.maxScrollX>=0?0:this.maxScrollX;if(g>this.minScrollY||g<this.maxScrollY)g=this.options.bounce?this.y+d/2:g>=this.minScrollY||this.maxScrollY>=
0?this.minScrollY:this.maxScrollY;this.distX+=c;this.distY+=d;this.absDistX=Math.abs(this.distX);this.absDistY=Math.abs(this.distY);if(!(this.absDistX<6&&this.absDistY<6)){if(this.options.lockDirection)if(this.absDistX>this.absDistY+5)g=this.y,d=0;else if(this.absDistY>this.absDistX+5)f=this.x,c=0;this.moved=!0;this._pos(f,g);this.dirX=c>0?-1:c<0?1:0;this.dirY=d>0?-1:d<0?1:0;if(h-this.startTime>300)this.startTime=h,this.startX=this.x,this.startY=this.y;this.options.onMove&&this.options.onMove.call(this,
a);this.options.onMoveEnd&&this.options.onMoveEnd.call(this,a)}}},_end:function(a){Mix.scroll.stop=!1;if(!(Mix.hasTouch&&a.touches.length!==0)){var b={dist:0,time:0},c={dist:0,time:0},d=(a.timeStamp||Date.now())-this.startTime,f=this.x,g=this.y;this._unbind(MOVE_EV);this._unbind(END_EV);this._unbind(CANCEL_EV);this.options.onBeforeEnd&&this.options.onBeforeEnd.call(this,a);if(this.moved){if(d<300&&this.options.momentum){b=f?this._momentum(f-this.startX,d,-this.x,this.scrollerW-this.wrapperW+this.x,
this.options.bounce?this.wrapperW:0):b;c=g?this._momentum(g-this.startY,d,-this.y,this.maxScrollY<0?this.scrollerH-this.wrapperH+this.y-this.minScrollY:0,this.options.bounce?this.wrapperH:0):c;f=this.x+b.dist;g=this.y+c.dist;if(this.x>0&&f>0||this.x<this.maxScrollX&&f<this.maxScrollX)b={dist:0,time:0};if(this.y>this.minScrollY&&g>this.minScrollY||this.y<this.maxScrollY&&g<this.maxScrollY)c={dist:0,time:0}}b.dist||c.dist?(b=Math.max(Math.max(b.time,c.time),10),this.scrollTo(Math.round(f),Math.round(g),
b)):this._resetPos(200)}else this._resetPos(400);this.options.onTouchEnd&&this.options.onTouchEnd.call(this,a)}},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind(TRNEND_EV),this._startAni())},_resize:function(){var a=this;setTimeout(function(){a.refresh()},Mix.isAndroid?200:0)},_resetPos:function(a){var b=this.x>=0?0:this.x<this.maxScrollX?this.maxScrollX:this.x,c=this.y>=this.minScrollY||this.maxScrollY>0?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;if(b==this.x&&
c==this.y){if(this.moved)this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this);if(this.hScrollbar&&this.options.hideScrollbar)"webkit"==Mix.cssVender&&(this.hScrollbarWrapper.style[Mix.transitionDelay]="300ms"),this.hScrollbarWrapper.style.opacity="0";if(this.vScrollbar&&this.options.hideScrollbar)"webkit"==Mix.cssVender&&(this.vScrollbarWrapper.style[Mix.transitionDelay]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(b,c,a||0)},_transitionTime:function(a){a+=
"ms";this.scroller.style[Mix.transitionDuration]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[Mix.transitionDuration]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[Mix.transitionDuration]=a)},_momentum:function(a,b,c,d,f){var b=Math.abs(a)/b,g=b*b/0.0012,h=0,h=0;a>0&&g>c?(c+=f/(6/(g/b*6.0E-4)),b=b*c/g,g=c):(d+=f/(6/(g/b*6.0E-4)),b=b*d/g,g=d);g*=a<9?-1:1;return{dist:g,time:Math.round(b/6.0E-4)}},_checkDOMChanges:function(){!this.moved&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*
this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale&&this.wrapperH==this.wrapper.clientHeight)&&this.refresh()},_pos:function(a,b){a=this.hScroll?a:0;b=this.vScroll?b:0;this.options.useTransform?this.scroller.style[Mix.transform]="translate("+a+"px,"+b+"px)"+Mix.translateZ:(a=Math.round(a),b=Math.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px");this.x=a;this.y=b;this._scrollbarPos("h");this._scrollbarPos("v")},_startAni:function(){var a=this,b=a.x,c=a.y,d=Date.now(),
f,g,h;if(!a.animating)if(a.steps.length){f=a.steps.shift();if(f.x==b&&f.y==c)f.time=0;a.animating=!0;a.moved=!0;a.options.useTransition?(a._transitionTime(f.time),a._pos(f.x,f.y),a.animating=!1,f.time?a._bind(TRNEND_EV):a._resetPos(0)):(h=function(){var i=Date.now();if(i>=d+f.time)a._pos(f.x,f.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),a._startAni();else if(i=(i-d)/f.time-1,g=Math.sqrt(1-i*i),i=(f.x-b)*g+b,a._pos(i,(f.y-c)*g+c),a.animating)a.aniTime=Mix.nextFrame.call(null,
h)},h())}else a._resetPos(400)},_scrollbar:function(a){var b,c;b=this[a+"ScrollbarWrapper"];if(this[a+"Scrollbar"]){if(!b){b=DOM.create("div");var d=Mix.cssPrefix;b.style.cssText="position:absolute;z-index:100;"+(a=="h"?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px;")+"pointer-events:none;"+d+"transition-property:opacity;"+d+"transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+
(this.options.hideScrollbar?"0":"1");this[a+"ScrollbarWrapper"]=b;c=DOM.create("div");c.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+d+"background-clip:padding-box;"+d+"box-sizing:border-box;"+(a=="h"?"height:100%":"width:100%")+";"+d+"border-radius:3px;border-radius:3px;pointer-events:none;"+d+"transition-property:"+d+"transform;"+d+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+d+"transition-duration:0;"+d+"transform: translate(0,0)"+
Mix.translateZ;this[a+"ScrollbarWrapper"].appendChild(c);this[a+"ScrollbarIndicator"]=c;this.wrapper.appendChild(b)}a=="h"?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,this.hScrollbarIndicatorSize=Math.max(Math.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=
this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=Math.max(Math.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY);this._scrollbarPos(a,!0)}else b&&(Mix.hasTransform&&(this[a+"ScrollbarIndicator"].style[Mix.transform]=""),b.parentNode.removeChild(b),this[a+"ScrollbarWrapper"]=
null,this[a+"ScrollbarIndicator"]=null)},_scrollbarPos:function(a,b){var c=a=="h"?this.x:this.y;if(this[a+"Scrollbar"])c*=this[a+"ScrollbarProp"],c<0?(this.options.fixedScrollbar||(c=this[a+"ScrollbarIndicatorSize"]+Math.round(c*3),c<8&&(c=8),this[a+"ScrollbarIndicator"].style[a=="h"?"width":"height"]=c+"px"),c=0):c>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?c=this[a+"ScrollbarMaxScroll"]:(c=this[a+"ScrollbarIndicatorSize"]-Math.round((c-this[a+"ScrollbarMaxScroll"])*3),c<8&&(c=8),
this[a+"ScrollbarIndicator"].style[a=="h"?"width":"height"]=c+"px",c=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-c))),this[a+"ScrollbarWrapper"].style[Mix.transitionDelay]="0",this[a+"ScrollbarWrapper"].style.opacity=b&&this.options.hideScrollbar?"0":"1",this[a+"ScrollbarIndicator"].style[Mix.transform]="translate("+(a=="h"?c+"px,0":"0,"+c+"px)")+Mix.translateZ},_bind:function(a,b,c){b=b||this.scroller;DOM.addEvent(b,a,this,c)},_unbind:function(a,b,c){b=b||this.scroller;DOM.removeEvent(b,
a,this,c)},refresh:function(){Mix.scroll.stop=!1;this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=this.scroller.offsetWidth;this.scrollerH=this.scroller.offsetHeight+this.minScrollY;this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY+(this.options.bottomOffset||0);this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=
this.options.hScroll&&this.maxScrollX<0;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;this._scrollbar("h");this._scrollbar("v");this.scroller.style[Mix.transitionDuration]="0";this._resetPos(400)},destroy:function(){this.scroller.style[Mix.transform]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");
this._scrollbar("v");this._unbind(START_EV);this._unbind(MOVE_EV);this._unbind(END_EV);this._unbind(CANCEL_EV);this.options.useTransition&&this._unbind(TRNEND_EV);this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},scrollTo:function(a,b,c,d){var f=a;this.stop();f.length||(f=[{x:a,y:b,time:c,relative:d}]);a=0;for(b=f.length;a<b;a++){if(f[a].relative)f[a].x=this.x-f[a].x,f[a].y=this.y-f[a].y;this.steps.push({x:f[a].x,y:f[a].y,time:f[a].time||
0})}this._startAni()},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(MOVE_EV);this._unbind(END_EV);this._unbind(CANCEL_EV)},enable:function(){this.enabled=!0},stop:function(){if(this.options.useTransition)this._unbind(TRNEND_EV);else if(this.aniTime)Mix.cancelFrame.call(null,this.aniTime),this.aniTime=null;this.steps=[];this.animating=this.moved=!1},isReady:function(){return!this.moved&&!this.animating}};
Mix.swipeView=function(a,b){var c,d,f;this.wrapper=typeof a=="string"?$(a):a;this.options={text:null,numberOfPages:3,snapThreshold:null,hastyPageFlip:!1,loop:!0};for(c in b)this.options[c]=b[c];this.wrapper.style.overflow="hidden";this.wrapper.style.position="relative";this.masterPages=[];d=DOM.create("div",{id:"swipeview-slider"});d.style.cssText="position:relative;top:0;height:100%;width:100%;"+Mix.cssPrefix+"transition-duration:0;"+Mix.cssPrefix+"transform:translateZ(0);"+Mix.cssPrefix+"transition-timing-function:ease-out";
this.wrapper.appendChild(d);this.slider=d;this.refreshSize();for(c=-1;c<2;c++){d=DOM.create("div");d.id="swipeview-masterpage-"+(c+1);d.style.cssText=Mix.cssPrefix+"transform:translateZ(0);position:absolute;top:0;height:100%;width:100%;left:"+c*100+"%";if(!d.dataset)d.dataset={};f=c==-1?this.options.numberOfPages-1:c;d.dataset.pageIndex=f;d.dataset.upcomingPageIndex=f;if(!this.options.loop&&c==-1)d.style.visibility="hidden";this.slider.appendChild(d);this.masterPages.push(d)}DOM.addEvent(this.wrapper,
START_EV,this);DOM.addEvent(this.slider,TRNEND_EV,this);Mix.cssVender=="O"&&DOM.addEvent(this.slider,TRNEND_EV.toLowerCase(),this)};
Mix.swipeView.prototype={currentMasterPage:1,x:0,page:0,pageIndex:0,customEvents:[],onFlip:function(a){DOM.addEvent(this.wrapper,"swipeview-flip",a);this.customEvents.push(["flip",a])},onMoveOut:function(a){DOM.addEvent(this.wrapper,"swipeview-moveout",a);this.customEvents.push(["moveout",a])},onMoveIn:function(a){DOM.addEvent(this.wrapper,"swipeview-movein",a);this.customEvents.push(["movein",a])},onTouchStart:function(a){DOM.addEvent(this.wrapper,"swipeview-touchstart",a);this.customEvents.push(["touchstart",
a])},destroy:function(){for(;this.customEvents.length;)DOM.removeEvent(this.wrapper,"swipeview-"+this.customEvents[0][0],this.customEvents[0][1]),this.customEvents.shift();DOM.removeEvent(this.wrapper,START_EV,this);DOM.removeEvent(this.wrapper,MOVE_EV,this);DOM.removeEvent(this.wrapper,END_EV,this);DOM.removeEvent(this.wrapper,CANCEL_EV,this);DOM.removeEvent(this.slider,TRNEND_EV,this)},refreshSize:function(){this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=this.wrapper.clientHeight;
this.pageWidth=this.wrapperWidth;this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth;this.snapThreshold=this.options.snapThreshold===null?Math.round(this.pageWidth*0.15):/%/.test(this.options.snapThreshold)?Math.round(this.pageWidth*this.options.snapThreshold.replace("%","")/100):this.options.snapThreshold},next:function(){if(this.options.loop||this.x!=this.maxX)this.directionX=-1,this.x-=1,this.__checkPosition()},prev:function(){if(this.options.loop||this.x!==0)this.directionX=
1,this.x+=1,this.__checkPosition()},handleEvent:function(a){switch(a.type){case START_EV:this.__start(a);break;case MOVE_EV:this.__move(a);break;case CANCEL_EV:case END_EV:this.__end(a);break;case "resize":this.__resize();break;case TRNEND_EV:case "otransitionend":a.target==this.slider&&!this.options.hastyPageFlip&&this.__flip()}},__pos:function(a){this.x=a;this.slider.style[Mix.transform]="translate("+a+"px,0)"+Mix.translateZ},__resize:function(){this.refreshSize();this.slider.style[Mix.transitionDuration]=
"0s";this.__pos(-this.page*this.pageWidth)},__start:function(a){a.preventDefault();if(!this.initiated)a=Mix.hasTouch?a.touches[0]:a,this.initiated=!0,this.thresholdExceeded=this.moved=!1,this.startX=a.pageX,this.startY=a.pageY,this.pointX=a.pageX,this.pointY=a.pageY,this.directionX=this.stepsY=this.stepsX=0,this.directionLocked=!1,this.slider.style[Mix.transitionDuration]="0s",DOM.addEvent(this.wrapper,MOVE_EV,this),DOM.addEvent(this.wrapper,END_EV,this),DOM.addEvent(this.wrapper,CANCEL_EV,this),
this.__event("touchstart")},__move:function(a){if(this.initiated){var b=Mix.hasTouch?a.touches[0]:a,c=b.pageX-this.pointX,d=b.pageY-this.pointY,f=this.x+c,g=Math.abs(b.pageX-this.startX);this.oriDist=b.pageX-this.startX;this.moved=!0;this.pointX=b.pageX;this.pointY=b.pageY;this.directionX=c>0?1:c<0?-1:0;this.stepsX+=Math.abs(c);this.stepsY+=Math.abs(d);if(!(this.stepsX<10&&this.stepsY<10))if(!this.directionLocked&&this.stepsY>this.stepsX)this.initiated=!1,Mix.scroll.outStop=!1;else{a.preventDefault();
this.directionLocked=Mix.scroll.outStop=!0;if(!this.options.loop&&(f>0||f<this.maxX))f=this.x+c/2;if(!this.thresholdExceeded&&g>=this.snapThreshold)this.thresholdExceeded=!0,this.__event("moveout");else if(this.thresholdExceeded&&g<this.snapThreshold)this.thresholdExceeded=!1,this.__event("movein");this.__pos(f)}}},__end:function(a){Mix.scroll.outStop=!1;if(this.initiated&&(a=Math.abs((Mix.hasTouch?a.changedTouches[0]:a).pageX-this.startX),this.initiated=!1,DOM.removeEvent(this.wrapper,MOVE_EV,this),
DOM.removeEvent(this.wrapper,END_EV,this),DOM.removeEvent(this.wrapper,CANCEL_EV,this),this.moved)){if(!this.options.loop&&(this.x>0||this.x<this.maxX))a=0,this.__event("movein");a<this.snapThreshold?(this.slider.style[Mix.transitionDuration]=Math.floor(300*a/this.snapThreshold)+"ms",this.__pos(-this.page*this.pageWidth)):this.__checkPosition()}},__checkPosition:function(){var a,b;a=this.options.numberOfPages;this.directionX>0?(this.page=-Math.ceil(this.x/this.pageWidth),this.currentMasterPage=this.page+
1-Math.floor((this.page+1)/3)*3,this.pageIndex=(this.page%a+a)%a,a=this.currentMasterPage-1,a=a<0?2:a,this.masterPages[a].style.left=this.page*100-100+"%",b=this.page-1):(this.page=-Math.floor(this.x/this.pageWidth),this.currentMasterPage=this.page+1-Math.floor((this.page+1)/3)*3,this.pageIndex=(this.page%a+a)%a,a=this.currentMasterPage+1,a=a>2?0:a,this.masterPages[a].style.left=this.page*100+100+"%",b=this.page+1);b-=Math.floor(b/this.options.numberOfPages)*this.options.numberOfPages;this.masterPages[a].dataset.upcomingPageIndex=
b;b=-this.page*this.pageWidth;this.slider.style[Mix.transitionDuration]=Math.floor(500*Math.abs(this.x-b)/this.pageWidth)+"ms";if(!this.options.loop)this.masterPages[a].style.visibility=b===0||b==this.maxX?"hidden":"";this.x==b?this.__flip():(this.__pos(b),this.options.hastyPageFlip&&this.__flip())},__flip:function(){this.__event("flip");for(var a=0;a<3;a++)this.masterPages[a].dataset.pageIndex=this.masterPages[a].dataset.upcomingPageIndex},__event:function(a){var b=DOC.createEvent("Event");b.initEvent("swipeview-"+
a,!0,!0);this.wrapper.dispatchEvent(b)}};
var Device={isMobi:function(){if(WIN.uexWindow)return!0;return!1},hasLoaded:!1,opCode:1,onLoad:function(a){function b(){if(!Device.hasLoaded)a(),Device.hasLoaded=!0}window.uexOnload=b;DOM.addEvent(DOC,"DOMContentLoaded",function(){setTimeout(function(){WIN.uexWindow||b()},1E3)})},destroy:function(){Device.isMobi()&&(Device.xmlHttp.isSending&&Device.xmlHttp.close(),uexWindow.closeToast())},clearCache:function(){if(Device.isMobi())uexWidgetOne.cbCleanCache=function(a,b,c){b==2&&c==0?alert("清除成功"):b==
2&&c==1&&alert("清除失败")},uexWidgetOne.cleanCache()},exit:function(){Device.isMobi()&&uexWidgetOne.exit()},alert:function(a,b,c){Device.isMobi()?uexWindow.alert(a,b,c):alert(a+":"+b)},toast:function(a,b){Device.isMobi()&&uexWindow.toast(0,5,a,b*1E3||2E3)},confirm:function(a,b,c,d,f){Device.isMobi()?(uexWindow.cbConfirm=function(a,d,f){switch(f*1){case 0:typeof b=="function"&&b();break;case 1:typeof c=="function"&&c()}},uexWindow.confirm(f||"确认",a,d||["确认","取消"])):window.confirm(a)?b&&b():c&&c()},actionThree:function(a,
b,c,d,f,g){if(Device.isMobi())uexWindow.cbConfirm=function(a,b,c){switch(c*1){case 0:typeof d=="function"&&d();break;case 1:typeof f=="function"&&f();break;case 2:typeof g=="function"&&g()}},uexWindow.confirm(a,b,c)},prompt:function(a,b,c,d,f){Device.isMobi()?(uexWindow.cbPrompt=function(a,d,f){a=eval("("+f+")");d=a.value;switch(a.num*1){case 0:b&&b(d);break;case 1:c&&c(d)}},uexWindow.prompt("",a,f||"",d||["确定","取消"])):(a=window.prompt(a),typeof a=="string"?b&&b(a):c&&c())},actionSheet:function(a){if(Device.isMobi())uexWindow.cbActionSheet=
a[3],uexWindow.actionSheet(a[0],a[1],a[2])},backFunc:[],menuFunc:null,setKeyPress:function(){if(Device.isMobi())uexWindow.onKeyPressed=function(a){0===a*1?Device.backFunc.length>0&&Device.backFunc[0].call(null):1===a*1&&$.isFunc(Device.menuFunc)&&Device.menuFunc.call(null)}},setBackBtn:function(){Device.isMobi()&&(Device.setKeyPress(),uexWindow.setReportKey("0","1"))},disetBackBtn:function(){Device.isMobi()&&uexWindow.setReportKey("0","0")},setMenuBtn:function(){Device.isMobi()&&(Device.setKeyPress(),
uexWindow.setReportKey("1","1"))},disetMenuBtn:function(){Device.isMobi()&&uexWindow.setReportKey("1","0")},datePicker:function(a,b,c){if(Device.isMobi()){uexControl.cbOpenDatePicker=function(a,f,g){f==1?(a=eval("("+g+")"),f=a.year+"-"+a.month+"-"+a.day,g=(new Date).getTime(),(new Date(a.year,a.month-1,a.day)).getTime()>g?alert("日期超过今天无效"):b?b(f):Device.toast(f)):c?c():Device.toast("日期没有选择成功")};a=a.getAttribute("default").split("-");if(0==a[0]||0==a[1]||0==a[2])a=["1992","12","12"];uexControl.openDatePicker(a[0],
a[1],a[2])}},getLocation:function(a){if(Device.isMobi())uexLocation.onChange=function(b,c){uexLocation.closeLocation();a(b,c)},uexLocation.openLocation()},getAddress:function(a,b,c,d){if(Device.isMobi())uexLocation.cbGetAddress=function(a,b,h){b==0?c(h):d?d():Device.toast("未能获得地址信息")},uexLocation.getAddress(a,b)},getPlatForm:function(a){function b(b,d,f){b="";d==2&&f==0&&(b="ios");d==2&&f==1&&(b="android");d==2&&f==4&&(b="wp");a&&a(b);Device.platStr=b}if(Device.isMobi())Device.platstr?a&&a(Device.platStr):
(uexWidgetOne.getPlatform(),uexWidgetOne.cbGetPlatform=b)},getAppVersion:function(a){function b(b,d,f){d==0?(a&&a(f),Device.appVersion=f):Device.toast("版本获取失败!")}Device.isMobi()?Device.appVersion?a&&a(Device.appVersion):(uexWidgetOne.cbGetVersion=b,uexWidgetOne.getVersion()):Device.toast("你不是手机，请自便。")},loadApp:function(a){Device.isMobi()&&uexWidget.loadApp(a)},installApp:function(a){Device.isMobi()&&uexWidget.installApp(a)},download:function(a,b,c){if(Device.isMobi()){Device.opCode++;var d=Device.opCode;
uexDownloaderMgr.onStatus=function(a,b,d,i){switch(i){case 0:uexWindow.toast("1","5","当前下载的进度："+d+"%","");break;case 1:uexWindow.alert("温馨提示","下载完成，请进行安装！","我知道了");uexDownloaderMgr.closeDownloader(a);uexWindow.closeToast();c();break;case 2:uexWindow.alert("温馨提示","下载失败，请联系管理员！","我知道了"),uexDownloaderMgr.closeDownloader(a)}};uexDownloaderMgr.cbCreateDownloader=function(c,g,h){h==0?uexDownloaderMgr.download(d,a,b,"0"):uexWindow.alert("温馨提示","创建下载资源失败，请确认你手机中装有SD存储卡。","我知道了")};uexDownloaderMgr.createDownloader(d)}},
xmlHttp:{isSending:!1,send:function(a){function b(a,b){for(var g=a.split("&"),h,i=g.length-1;i>=0;i--)h=g[i].split("="),2===h.length&&uexXmlHttpMgr.setPostData(c.opCode,!b?"0":"1",h[0],h[1])}if(Device.isMobi())if(a.src){var c={opCode:Device.opCode++,method:"POST",timeout:0};extend(c,a);uexXmlHttpMgr.onPostProgress=c.progressCb;uexXmlHttpMgr.onData=c.secCb;uexXmlHttpMgr.open(c.opCode,c.method.toUpperCase(),c.src,c.timeout);b(c.plainPara,!1);b(c.sourcePara,!0);Device.xmlHttp.isSending=!0;Device.xmlHttp.opCode=
c.opCode;uexXmlHttpMgr.send(c.opCode)}else Device.toast("缺少xmlHttp请求地址。")},close:function(){if(Device.xmlHttp.isSending)uexXmlHttpMgr.close(Device.xmlHttp.opCode),Device.xmlHttp.isSending=!1}},getFileSize:function(a,b){if(Device.isMobi()){Device.opCode++;var c=Device.opCode;uexFileMgr.cbGetFileSize=function(a,c,g){c==2&&b&&b(g/1024)};uexFileMgr.openFile(c,a,1);uexFileMgr.getFileSize(c);uexFileMgr.closeFile(c)}},camera:function(a){if(Device.isMobi())uexCamera.cbOpen=function(b,c,d){a(b,c,d)},uexCamera.open()},
imageBrowser:function(a){Device.isMobi()&&(a=$.isArray(a)?a:[a],uexImageBrowser.open(a,0,0))},imagePick:function(a){if(Device.isMobi())uexImageBrowser.cbPick=function(b,c,d){a(b,c,d)},uexImageBrowser.pick()},call:function(a){Device.isMobi()&&(a="phone".replace(/phone/,a),uexCall.call(a))},dial:function(a){Device.isMobi()&&(a="phone".replace(/phone/,a),uexCall.dial(a))}};Mix.x=function(a){this.options={varsEncode:!1,method:"get",dataType:"json",timeOut:15};extend(this.options,a||{});return this.reset()};
Mix.x.jsonpIdx=0;
Mix.x.prototype={reset:function(){clearTimeout(this.timer);this.loading=!1;this.data="";return this},ajaxJSONP:function(a,b){var c=this,d="Mix_x_jsonp"+Mix.x.jsonpIdx++,f=DOM.create("script");WIN[d]=function(a){c.response=a;delete WIN[d];c.reset().onLoad();HEAD.removeChild(f)};a=a.replace(/=\?/,"="+d)+(b?"&"+b:"");f.src=a;f.onerror=function(){c.onFail()};HEAD.appendChild(f)},send:function(a,b){var c=this;if(/=\?/.test(a))return c.ajaxJSONP(a,b);if(!c.loading){var d=c.options,f=c.xmlhttp||(WIN.XMLHttpRequest?
new XMLHttpRequest:!1);if(f)c.xmlhttp=f,c.loading=!0,c.onStart(),f.onreadystatechange=function(){if(4===this.readyState&&0!==this.status&&c.timer){var a=this.responseText;c.response="json"==d.dataType?JSON.parse(a):a;c.reset().onLoad();f.onreadystatechange=function(){};c=f=null}};else return c.onFail(),c;d.method.toLowerCase()=="get"?(b?a.match(/\?.*=/)?b="&"+b:b[0]!="?"&&(b="?"+b):b="",a+=b,f.open("get",a,!0),f.send()):(f.open("post",a,!0),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),
f.send(b));c.timer=setTimeout(function(){c._onTimeout.apply(c)},d.timeOut*1E3);return c}},abort:function(){if(this.loading)this.xmlhttp.abort(),this.reset(),this.loading=!1},_onTimeout:function(){this.abort();this.onTimeout()},onStart:function(){},onLoad:function(){},onFail:function(){},onTimeout:function(){}};
Mix.regions={provinces:["北京","上海","重庆","安徽","福建","甘肃","广东","广西","贵州","海南","河北","黑龙江","河南","香港","湖北","湖南","江苏","江西","吉林","辽宁","澳门","内蒙古","宁夏","青海","山东","山西","陕西","四川","台湾","天津","新疆","西藏","云南","浙江","海外"],getCity:function(a){var b=[];switch(a){case "安徽":b=["合肥","安庆","蚌埠","亳州","巢湖","池州","滁州","阜阳","淮北","淮南","黄山","六安","马鞍山","宿州","铜陵","芜湖","宣城"];break;case "北京":b=["东城","西城","崇文","宣武","朝阳","丰台","石景山","海淀","门头沟","房山","通州","顺义","昌平","大兴","平谷","怀柔","密云","延庆"];break;case "重庆":b=["万州","涪陵","渝中","大渡口","江北","沙坪坝",
"九龙坡","南岸","北碚","万盛","双挢","渝北","巴南","黔江","长寿","綦江","潼南","铜梁","大足","荣昌","壁山","梁平","城口","丰都","垫江","武隆","忠县","开县","云阳","奉节","巫山","巫溪","石柱","秀山","酉阳","彭水","江津","合川","永川","南川"];break;case "福建":b=["福州","龙岩","南平","宁德","莆田","泉州","三明","厦门","漳州"];break;case "甘肃":b=["兰州","白银","定西","甘南州","嘉峪关","金昌","酒泉","临夏州","陇南","平凉","庆阳","天水","武威","张掖"];break;case "广东":b=["广州","潮州","东莞","佛山","河源","惠州","江门","揭阳","茂名","梅州","清远","汕头","汕尾","韶关","深圳","阳江","云浮","湛江","肇庆","中山","珠海"];break;case "广西":b=["南宁","百色","北海","崇左","防城港","桂林",
"贵港","河池","贺州","来宾","柳州","钦州","梧州","玉林"];break;case "贵州":b=["贵阳","安顺","毕节地区","六盘水","铜仁地区","遵义","黔西南州","黔东南州","黔南州"];break;case "海南":b=["海口","白沙","保亭","昌江","儋州","澄迈","东方","定安","琼海","琼中","乐东","临高","陵水","三亚","屯昌","万宁","文昌","五指山"];break;case "河北":b=["石家庄","保定","沧州","承德","邯郸","衡水","廊坊","秦皇岛","唐山","邢台","张家口"];break;case "黑龙江":b=["哈尔滨","大庆","大兴安岭地区","鹤岗","黑河","鸡西","佳木斯","牡丹江","七台河","齐齐哈尔","双鸭山","绥化","伊春"];break;case "河南":b=["郑州","安阳","鹤壁","焦作","开封","洛阳","漯河","南阳","平顶山","濮阳","三门峡","商丘","新乡","信阳","许昌","周口",
"驻马店"];break;case "香港":b=["香港","九龙","新界"];break;case "湖北":b=["武汉","鄂州","恩施","黄冈","黄石","荆门","荆州","潜江","神农架林区","十堰","随州","天门","仙桃","咸宁","襄樊","孝感","宜昌"];break;case "湖南":b=["长沙","常德","郴州","衡阳","怀化","娄底","邵阳","湘潭","湘西州","益阳","永州","岳阳","张家界","株洲"];break;case "江苏":b=["南京","常州","淮安","连云港","南通","苏州","宿迁","泰州","无锡","徐州","盐城","扬州","镇江"];break;case "江西":b=["南昌","抚州","赣州","吉安","景德镇","九江","萍乡","上饶","新余","宜春","鹰潭"];break;case "吉林":b=["长春","白城","白山","吉林市","辽源","四平","松原","通化","延边"];break;case "辽宁":b=["沈阳","鞍山","本溪",
"朝阳","大连","丹东","抚顺","阜新","葫芦岛","锦州","辽阳","盘锦","铁岭","营口"];break;case "澳门":b=["澳门"];break;case "内蒙古":b=["呼和浩特","阿拉善盟","包头","巴彦淖尔","赤峰","鄂尔多斯","呼伦贝尔","通辽","乌海","乌兰察布","锡林郭勒盟","兴安盟"];break;case "宁夏":b=["银川","固原","石嘴山","吴忠","中卫"];break;case "青海":b=["西宁","果洛州","海东地区","海北州","海南州","海西州","黄南州","玉树州"];break;case "山东":b=["济南","滨州","东营","德州","菏泽","济宁","莱芜","聊城","临沂","青岛","日照","泰安","威海","潍坊","烟台","枣庄","淄博"];break;case "上海":b=["崇明","黄浦","卢湾","徐汇","长宁","静安","普陀","闸北","虹口","杨浦","闵行","宝山","嘉定","浦东","金山","松江","青浦",
"南汇","奉贤","朱家角"];break;case "山西":b=["太原","长治","大同","晋城","晋中","临汾","吕梁","朔州","忻州","阳泉","运城"];break;case "陕西":b=["西安","安康","宝鸡","汉中","商洛","铜川","渭南","咸阳","延安","榆林"];break;case "四川":b=["成都","阿坝州","巴中","达州","德阳","甘孜州","广安","广元","乐山","凉山州","泸州","南充","眉山","绵阳","内江","攀枝花","遂宁","雅安","宜宾","资阳","自贡"];break;case "台湾":b=["台北","基隆","台南","台中","高雄","屏东","南投","云林","新竹","彰化","苗栗","嘉义","花莲","桃园","宜兰","台东","金门","马祖","澎湖","其它"];break;case "天津":b=["天津","和平","东丽","河东","西青","河西","津南","南开","北辰","河北","武清","红挢","塘沽","汉沽","大港",
"宁河","静海","宝坻","蓟县"];break;case "新疆":b=["乌鲁木齐","阿拉尔","阿克苏地区","阿勒泰地区","巴音郭楞","博尔塔拉州","昌吉州","哈密地区","和田地区","喀什地区","克拉玛依","克孜勒苏州","石河子","塔城地区","图木舒克","吐鲁番地区","五家渠","伊犁州"];break;case "西藏":b=["拉萨","阿里地区","昌都地区","林芝地区","那曲地区","日喀则地区","山南地区"];break;case "云南":b=["昆明","保山","楚雄州","大理州","德宏州","迪庆州","红河州","丽江","临沧","怒江州","普洱","曲靖","昭通","文山","西双版纳","玉溪"];break;case "浙江":b=["杭州","湖州","嘉兴","金华","丽水","宁波","衢州","绍兴","台州","温州","舟山"];break;case "海外":b=["美国","英国","法国","瑞士","澳洲","新西兰","加拿大","奥地利","韩国","日本","德国","意大利",
"西班牙","俄罗斯","泰国","印度","荷兰","新加坡","欧洲","北美","南美","亚洲","非洲","大洋洲"]}return b},getLngLat:function(a,b){switch(a+b){case "安徽马鞍山":return[118.515882,31.688528];case "辽宁朝阳":return[120.444715,41.594119];case "海南白沙":return[109.358586,19.216056];case "海南保亭":return[109.656113,18.597592];case "海南昌江":return[109.0113,19.222483];case "海南陵水":return[109.948661,18.575985];case "海南五指山":return[109.51775,18.831306];case "海南乐东":return[109.062698,18.658614];case "河南平顶山":return[113.300849,33.745301];case "云南临沧":return[100.092613,
23.887806];case "云南普洱":return[100.980058,22.788778];case "黑龙江双鸭山":return[131.171402,46.655102]}return!1}};Mix.ui={};
Mix.ui.tips={destroy:function(){this.hasTip&&(this.container.removeChild(this.tipDom),delete this.hasTip,delete this.container,delete this.tipDom);this.reset()},reset:function(){this.option={msg:"",contSel:"body",tipH:0,hideT:5E3};this.timer&&(clearTimeout(this.timer),delete this.timer)},show:function(a){var b=this;b.reset();a&&extend(b.option,a);if(b.option.msg){if(!b.hasTip)b.tipDom=DOM.create("div",{className:"tipsShow"}),b.container=$(b.option.contSel)||BODY,b.container.appendChild(b.tipDom),
b.hasTip=!0,DOM.addEvent(b.tipDom,CLICK_EV,function(){b.hide()});b.tipDom.innerHTML=b.option.msg;b.tipDom.style.display="block";b.option.tipH=b.tipDom.offsetHeight;setTimeout(function(){b.tipDom&&(b.tipDom.style.bottom="0px")},0);if(b.option.hideT)b.timer=setTimeout(function(){b.hide()},b.option.hideT)}},hide:function(){var a=this;try{a.tipDom.style.bottom="-"+a.option.tipH+"px",a.reset(),a.timer=setTimeout(function(){delete a.timer;a.tipDom.style.display="none"},600)}catch(b){Mix.base.logErr(b,"Mix.ui.tips.hide")}}};
Mix.ui.mask=function(a){this.show(a);return this};Mix.ui.mask.prototype={show:function(){var a={cont:"body",maskClickCb:null};arguments.length>0&&extend(a,arguments[0]);this.container=$(a.cont);this.maskDom=DOM.create("div",{className:"pageMask"});this.container.appendChild(this.maskDom);a.maskClickCb&&DOM.addEvent(this.maskDom,CLICK_EV,a.maskClickCb)},hide:function(){this.container.removeChild(this.maskDom);delete this.maskDom;delete this.container}};
Mix.ui.loading={show:function(a,b,c,d){a=a||BODY;if(b)c=c||15,this.outInter&&clearTimeout(this.outInter),this.outInter=setTimeout(b,c*1E3);$("#ui_load")&&DOM.remove($("#ui_load"));b=d&&"word"==d?DOM.create("div",{id:"ui_load",innerHTML:"<div>L</div><div>O</div><div>A</div><div>D</div><div>I</div><div>N</div><div>G</div>"}):DOM.create("div",{id:"ui_load",className:"ui_load_circle"});a.appendChild(b)},hide:function(){$("#ui_load")&&DOM.remove($("#ui_load"));if(this.outInter)clearTimeout(this.outInter),
this.outInter=null}};
Mix.ui.popLayer={className:"popLayer",domStr:['<div class="">',"</div>"],reset:function(){this.option={domId:"layerSel",domCls:"layerSelWrap",title:!1,hasConfirm:!1,useMask:!0,clickMaskHide:!0,canScroll:!1,contSel:"body",onShow:null,hideEnd:null};delete this.layerDom;delete this.container;this.scroller&&(this.scroller.destroy(),delete this.scroller);if(this.token)Mix.obs.unsubscribe(this.token),this.token=null;this.subReset&&this.subReset()},show:function(a){var b=this,c=b.domStr.clone();b.reset();
a&&extend(b.option,a);b.preShow&&b.preShow();$("#"+b.option.domId)&&($("#"+b.option.domId).parentNode.removeChild($("#"+b.option.domId)),b.option.useMask&&b.mask.hide(),b.option.hideEnd&&b.option.hideEnd.call(null));b.option.title&&c.push('<h3 class="pop_title">',b.option.title,"</h3>");"popLayer"!=b.className&&b.option.hasConfirm&&c.push('<div class="pop_confirm clearfix">','<a class="confirm" _click="Mix.ui.'+b.className+'.confirm()">确认</a>','<a class="cancel" _click="Mix.ui.'+b.className+'.cancel()">取消</a>',
"</div>");b.option.onShow&&b.option.onShow.call(null,b);b.layerDom=DOM.create("div",{id:b.option.domId,className:b.option.domCls});DOM.addClass(b.layerDom,"pop_layer");b.layerDom.innerHTML=c.join("");b.option.useMask?(a={},b.option.clickMaskHide&&(a={maskClickCb:function(a){a.target==b.mask.maskDom&&(b.hide(),b.option.onCancel&&b.option.onCancel())}}),b.mask=new Mix.ui.mask(a),b.container=b.mask.maskDom):b.container=$(b.option.contSel);b.layerDom.style.display="none";b.container.appendChild(b.layerDom);
b.subShow&&b.subShow();b.layerDom.style.display="block";a={vScrollbar:!0};if(b.option.title)c=$(".pop_title",b.layerDom).offsetHeight,a.topOffset=-c,$("div",b.layerDom).style.paddingTop=c+"px";if(b.option.canScroll)b.scroller=new Mix.scroll(b.option.domId,a);if(b.setSizePos)b.token=Mix.obs.subscribe("resize",function(){b.setSizePos()})},hide:function(){this.container.removeChild(this.layerDom);this.option.useMask&&this.mask.hide();this.option.hideEnd&&this.option.hideEnd.call(null);this.subHide&&
this.subHide()}};
Mix.ui.menu=extend({},Mix.ui.popLayer,{className:"menu",domStr:['<div class="">',"</div>"],subReset:function(){delete this.ancEl;extend(this.option,{domId:"menuSel",domCls:"menuLayer",pos:"bottom",useMask:!0,items:[],direct:"horizon"})},preShow:function(){$("#selectSel")&&Mix.ui.select.hide()},subShow:function(){var a=[];if(!(this.option.items.length<1))$.each(this.option.items,function(b,c){a.unshift('<i _click="Mix.ui.menu.select(this,'+c+')">'+b+"</i>")}),$("div",this.layerDom).innerHTML=a.join(""),
this.setSizePos()},setSizePos:function(){try{var a=this.option,b="vertical"==this.option.direct,c=DOM.getSize(this.container)[0],d=DOM.getSize(this.container)[1],f=this.layerDom,g=$$("i",this.layerDom),h=a.items.length,i=Math.ceil(h/2),j;DOM.addClass(this.layerDom,a.pos);b&&DOM.addClass(this.layerDom,"vertiDirect");if(!b)j=Math.floor(c/h),$.each(g,function(a){a.style.width=j+"px"}),g[i].style.width=c-j*(h-1)+"px";f.style.display="block";if($("div",f).offsetHeight>f.offsetHeight)f.style.height=d+"px",
this.option.canScroll=!0}catch(k){Mix.base.logErr(k,"Mix.ui.menu.setSizePos")}},select:function(a,b){this.hide();this.option.onSelect&&this.option.onSelect(b)}});
Mix.ui.region=extend({},Mix.ui.popLayer,{className:"region",domStr:['<div class="selectWrap clearfix">','<label class="provSel" _click="Mix.ui.region.chooseProv()">',"</label>",'<label class="citySel" _click="Mix.ui.region.chooseCity()">',"</label>","</div>"],subReset:function(){extend(this.option,{prov:"",city:"",domId:"regionSel",domCls:"regionLayer",hasConfirm:!0,provProm:"选择省份",cityProm:"选择城市",clickMaskHide:!1,onConfirm:null,onCancel:null});$("#selectSel")&&Mix.ui.select.hide();delete this.provSel;
delete this.citySel},subShow:function(){this.provSel=$(".provSel",this.layerDom);this.citySel=$(".citySel",this.layerDom);this.provSel.innerHTML=this.option.prov||this.option.provProm;this.citySel.innerHTML=this.option.city||this.option.cityProm},chooseProv:function(){var a=this,b=Mix.regions.provinces.clone(),b=b.remove("台湾").remove("海外");Mix.ui.select.show({useMask:!1,options:b,defOptions:[a.option.prov||a.option.provProm],onConfirm:function(b){a.provSel.innerHTML=b[0];a.citySel.innerHTML=a.option.cityProm;
a.option.prov=a.option.provProm==b[0]?"":b[0];a.option.city=""},onShow:function(a){Device.backFunc.unshift(function(){a.hide()})},hideEnd:function(){Device.backFunc.shift(0);if(Device.backFunc.length<=0)Device.backFunc=[function(){ViewMgr.back()}]}})},chooseCity:function(){var a=this;a.option.prov?Mix.ui.select.show({useMask:!1,options:Mix.regions.getCity(a.option.prov)||[],defOptions:[a.option.city||a.option.cityProm],onConfirm:function(b){a.citySel.innerHTML=b[0];a.option.city=a.option.cityProm==
b[0]?"":b[0]},onShow:function(a){Device.backFunc.unshift(function(){a.hide()})},hideEnd:function(){Device.backFunc.shift(0);if(Device.backFunc.length<=0)Device.backFunc=[function(){ViewMgr.back()}]}}):toast("需先选择省份")},confirm:function(){this.hide();this.option.onConfirm&&this.option.onConfirm(this.option.prov,this.option.city)},cancel:function(){this.hide();this.option.onCancel&&this.option.onCancel()}});
Mix.ui.select=extend({},Mix.ui.popLayer,{className:"select",domStr:['<div><ul class="optWrap"></ul></div>'],subReset:function(){extend(this.option,{domId:"selectSel",domCls:"selectLayer",hasConfirm:!1,options:[],defOptions:[],selOptions:[],multi:!1,canScroll:!0})},preShow:function(){if(this.option.multi)this.option.hasConfirm=!0},subShow:function(){var a=this,b=[];if(a.option.options.length===0)toast("没有可供选择的项目");else{a.option.multi&&DOM.addClass(a.layerDom,"multiSelect");if(a.option.defOptions)a.option.selOptions=
a.option.defOptions;$.each(a.option.options,function(c,d){var f="";a.option.defOptions&&a.option.defOptions.has(c)&&(f=' class="selected"');b.unshift("<li"+f+' _click="Mix.ui.select.select(this,'+d+')">'+c+"</li>")});$(".optWrap",a.layerDom).innerHTML=b.join("");a.layerDom.style.display="block";if(a.layerDom.offsetHeight-BODYFS*0.5>=$("ul",a.layerDom).offsetHeight)a.option.canScroll=!1}},select:function(a,b){var c=this.option.options[b];this.option.multi?this.option.selOptions.has(c)?(DOM.removeClass(a,
"selected"),this.option.selOptions.remove(c)):(DOM.addClass(a,"selected"),this.option.selOptions.push(c)):(DOM.removeClass($$(".optWrap li",this.layerDom),"selected"),this.option.selOptions=[c],this.confirm())},confirm:function(){(this.option.onConfirm&&this.option.onConfirm(this.option.selOptions)||!this.option.multi)&&this.hide()},cancel:function(){this.hide();this.option.onCancel&&this.option.onCancel()}});
function toast(a,b){Device.isMobi()?Device.toast(a,b):Mix.ui.tips.show({msg:a,contSel:"#content",hideT:b*1E3||3E3})}
(function(){var a='<\!--header开始--\><div id="header" class="uh"><div class="header_btn header_left" _click="ViewMgr.back()"><img src="css/images/return.png" alt="返回"/></div>'.replace("返回","取消"),b={login:'${headerBack}<h1 class="ub-f1 ut-s tx-c">登录</h1><div class="header_btn header_right" _click="ViewMgr.gotoPage(\'password\');">忘记密码</div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div class="login_box"><div class="ub login_input ub-ac"　style="z-index:111"><label>昵　　称：</label><div class="ub-f1 login_text uinput"><input id="nickname" type="text" /></div></div><div class="ub login_input ub-ac"><label>登陆密码： </label><div class="ub-f1 login_text uinput"><input  id="password" type="password" /></div></div><div class="login_enter" _click="UserAction.checkLogin(\'#nickname\',\'#password\',this)">登录</div></div><div class="go_login" _click="ViewMgr.gotoPage(\'regist\');"><strong>注册新账户</strong></div></div></div><\!--content结束--\>',password:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">忘记密码</h1><div class="header_btn header_right" _click="UserAction.changePwd()">完成</div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><h2 class="integral_title password">填写你的邮箱，我们将发送重置密码的链接到这个邮箱：</h2><div class="ub login_input ub-ac"><div class="ub-f1 login_text uinput"><input id="password_val" type="text" /></div></div></div></div><\!--content结束--\>',
regist:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">注册</h1><div class="header_btn header_right" _click="UserAction.userRegist()">完成</div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix login_h"><div><div class="login_box"><div class="ub login_input ub-ac"　style="z-index:111"><label>昵　　称：</label><div class="ub-f1 login_text uinput"><input id="regNickName" type="text" /></div></div><div class="ub login_input ub-ac"><label>绑定邮箱： </label><div class="ub-f1 login_text uinput"><input id="regEmail" type="text" /></div></div><div class="ub login_input ub-ac"><label>登陆密码： </label><div class="ub-f1 login_text uinput"><input id="regPwd" type="password" /></div></div><div class="ub login_input ub-ac"><label>确认密码：</label><div class="ub-f1 login_text uinput"><input id="regPwdR" type="password" /></div></div></div></div></div><\!--content结束--\>',
"new":'<\!--header开始--\><div id="header" class="uh"><h1 class="ub-f1 ut-s tx-c" tabindex="0">最新商品</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div class="new_list_box"></div><div class="switch" _click="UserTools.swipeViewClick()"><div id="switch_img" class="switch_img"></div><ol id="switch_nav" class="switch_number ub"></ol></div></div></div><\!--content结束--\>',sale:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0" id="sale_title">特卖会</h1><div class="header_btn header_right" _click="Feed.refresh()"><img src="css/images/load.png" alt="刷新"/></div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div class="pullDown"><span class="pullDownIcon"></span><span class="pullDownLabel">下拉查看更多...</span></div><div class="product_nav"><div><ul id="saleTitle"><li class="select"><span>全部</span></li></ul></div></div><div class="new_list_box"></div></div></div><\!--content结束--\>',
product:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0" id="product_name">商品名称</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix warp"><div><div class="product_img"><img id="product_img" src="" alt="产品图" /><div class="product_price">￥</div></div><div class="product_info"><p></p></div><div class="product_comment"><h2 class="comment_title">评论(共0条)</h2><ol class="comment_list"></ol></div><h2 class="comment_title">宝贝详情</h2><div class="product_img" id="product_img_list"></div></div></div><\!--content结束--\>',
comment:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">评论</h1><\!--返回按钮--\><div _click="UserAction.sendComment($(\'#comment_input\'))" class="header_btn header_right">完成</div><\!--返回按钮结束--\></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix warp"><div><div class="comment_input uinput"><textarea id="comment_input" placeholder="请输入评论..."></textarea></div><p class="limit">还可以输入<span>150</span>字</p></div></div><\!--content结束--\>',commentList:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">所有评论</h1><div _click="UserAction.productComment()" class="header_btn header_right">评论</div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix warp"><div><div class="comment_box"><h2 class="comment_title">评论(共0条)</h2><ol class="comment_list"></ol></div></div></div><\!--content结束--\>',
tradeMap:'<\!--header开始--\><div id="header" class="uh"><div _click="ViewMgr.gotoPage(\'tradeList\')" class="header_btn header_left"><img src="css/images/list.png" alt="列表"/></div><h1 class="ub-f1 ut-s tx-c" tabindex="0">商户</h1><div _click="UserTools.initArea(function(prov,city){Mix.map.setCity(prov,city);})" class="header_btn header_right"><label id="tradeMap_city">上海</label><img class="head_switch" src="css/images/switch.png" alt="地区"/></div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div class="trolley" id="ui_slide" _click="Mix.map.slideTo(this)"><div class="trolley_bg"></div><div class="trolley_btn" _move="map_slide"><div class="trolley_tips">100m</div></div></div><div id="trade_map"></div></div></div><\!--content结束--\>',
tradeList:'<\!--header开始--\><div id="header" class="uh"><div _click="ViewMgr.gotoPage(\'tradeMap\')" class="header_btn header_left"><img src="css/images/map.png" alt="地图"/></div><h1 class="ub-f1 ut-s tx-c" tabindex="0">商户</h1><div _click="UserTools.initArea(function(prov,city){Mix.map.setCity(prov,city);})" class="header_btn header_right"><label id="tradeMap_city">上海</label><img class="head_switch" src="css/images/switch.png" alt="地区"/></div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div class="search ub ub-ac"><div class="ub-f1 uinput search_input"><input type="text" placeholder="输入文本..." /></div><input type="button" class="search_btn" _click="Mix.map.searchString(this);" value="搜 索" /></div><div class="trolley trade_list_trolley" id="ui_slide" _click="Mix.map.slideTo(this)"><div class="trolley_bg"></div><div class="trolley_btn" _move="map_slide"><div class="trolley_tips">100m</div></div></div><div class="trade_list"></div></div></div><\!--content结束--\>',
tradePage:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0" id="trade_name"></h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix warp"><div><div class="trade_like ub"><div class="pic" _click="UserAction.getTradePic()"><img id="trade_pic" src="" alt="商户图" /></div><div class="info ub-f1"><h2 id="trade_name_2"></h2><div class="trade_like_text ub ub-ac"><p class="ub-f1" id="trade_desc"></p><span class="trade_like_btn" _click="UserAction.attentionTrade(this)">关注</span></div></div></div><div class="product_info clearfix"><p id="address">地址：</p><p id="traffic">轨交：</p><span class="trade_map" id="showTradeMap" _click="UserAction.showTradeMap()">查看地图</span></div><ul class="trade_tel"><li class="ub trade_tel_list ub-ac" _click="UserAction.showTradeTell()"><div class="trade_tel_ico"></div><div class="ub-f1"><strong>电话：</strong><label id="tell"></label></div><div class="comment_more"><img src="css/images/arrow.png" alt="更多" /></div></li><li class="ub trade_tel_list ub-ac" _click="UserAction.showTradeFavo()"><div class="trade_tel_ico_a"></div><div class="ub-f1"><strong>优惠券/活动</strong><label id="privilege"></label></div><div class="comment_more"><img src="css/images/arrow.png" alt="更多" /></div></li><li><div class="product_comment trade_comment"><h3 class="comment_title">评论(共<label id="comment_num">0</label>条)</h3><ol class="comment_list"></ol></div></li><li class="ub trade_tel_list ub-ac" _click="UserAction.showTradeMap()"><div class="ub-f1"><strong>交通地图</strong></div><div class="comment_more"><img src="css/images/arrow.png" alt="更多" /></div></li></ul></div></div><\!--content结束--\>',
tradeMapNavi:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">地图</h1><div _click="UserTools.drawRoute()" class="header_btn header_right">导航</div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div id="trade_map" _longtap="Mix.map.menu()"></div></div><\!--content结束--\>',tradePic:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">商户图片</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div class="new_list_box"></div></div></div><\!--content结束--\>',
activity:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">活动</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div class="coupon_box"><ol class="coupon_list"></ol></div></div><\!--content结束--\>',activityInfo:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0" id="activityInfo_title">活动详细</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div id="activityInfo_content" style="color:#333;padding:1em;width:auto;"></div></div><\!--content结束--\>',
more:'<\!--header开始--\><div id="header" class="uh"><h1 class="ub-f1 ut-s tx-c" tabindex="0">更多</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div class="more_box"><ol><li class="ub ub-ac" _click="ViewMgr.gotoPage(\'myAccount\')"><div class="ub-f1">我的账号</div><span><img class="more_ico" src="css/images/arrow.png" alt="更多" /></span></li><li class="ub ub-ac" _click="ViewMgr.gotoPage(\'attentionTrade\')"><div class="ub-f1">关注的商户 (<span id="attention_num" class="more_blue">0</span>)</div><span><img class="more_ico" src="css/images/arrow.png" alt="更多" /></span></li><li class="ub ub-ac" _click="ViewMgr.gotoPage(\'favoriteProduct\')"><div class="ub-f1">我的收藏 (<span id="favorite_num" class="more_blue">0</span>)</div><span><img class="more_ico" src="css/images/arrow.png" alt="更多" /></span></li><li class="ub ub-ac" _click="ViewMgr.gotoPage(\'integral\')"><div class="ub-f1">积分查询</div><span><img class="more_ico" src="css/images/arrow.png" alt="更多" /></span></li><li class="ub ub-ac" _click="ViewMgr.gotoPage(\'systemMsg\')"><div class="ub-f1" id="systemMsg_un">系统消息</div><span><img class="more_ico" src="css/images/arrow.png" alt="更多" /></span></li><li class="ub ub-ac" _click="ViewMgr.gotoPage(\'opinion\')"><div class="ub-f1">意见反馈</div><span><img class="more_ico" src="css/images/arrow.png" alt="更多" /></span></li><li class="ub ub-ac" _click="ViewMgr.gotoPage(\'about\')"><div class="ub-f1">关于我们</div><span><img class="more_ico" src="css/images/arrow.png" alt="更多" /></span></li><li class="ub ub-ac" _click="UserAction.logOut()"><div class="ub-f1">退出当前帐号</div><span><img class="more_ico" src="css/images/arrow.png" alt="更多" /></span></li></ol></div></div><\!--content结束--\>',
myAccount:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">我的帐号</h1><\!--返回按钮--\><div _click="UserAction.config()" class="header_btn header_right">完成</div><\!--返回按钮结束--\></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div class="id_box"><div class="id_email_box"><h2 id="myAccount_nickname">adidas管理员</h2><div class="id_email ub"><div class="ub-f1 uinput id_email_input"><input id="myAccount_email" type="text" placeholder="绑定邮箱..." /></div><input type="button" _click="UserAction.setEmail($(\'#myAccount_email\'))" class="id_email_btn" value="更 换" /></div></div></div></div><\!--content结束--\>',
attentionTrade:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">关注的商户(<label id="attentionTrade_num">0</label>)</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div id="attentionTrade_list" class="trade_list"></div></div></div><\!--content结束--\>',favoriteProduct:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">我的收藏(<label id="favoriteProduct_num">0</label>)</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div class="new_list_box"></div></div></div><\!--content结束--\>',
integral:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">我的积分</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><h2 class="integral_title">当前积分为：</h2><p class="integral_list" id="integral_point">0点</p></div></div><\!--content结束--\>',systemMsg:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">系统消息</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div class="system_box"><ol></ol></div></div><\!--content结束--\>',
opinion:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">意见反馈</h1><\!--返回按钮--\><div _click="UserAction.sendFeedBack($(\'#opinion_ipt\'),$(\'#contact_ipt\'))" class="header_btn header_right">完成</div><\!--返回按钮结束--\></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix warp"><div><h2 class="opinion_title">您的想法和建议：</h2> <div class="comment_input uinput"><textarea id="opinion_ipt" placeholder="请输入评论..."></textarea></div><h2 class="opinion_title">联系方式(输入QQ或者邮箱)：</h2> <div class="opinion_input uinput"><input id="contact_ipt" type="text" /></div></div></div><\!--content结束--\>',
about:'${headerBack}<h1 class="ub-f1 ut-s tx-c" tabindex="0">关于我们</h1></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix"><div><div class="about_logo"><img src="css/images/logo.png" alt="adidas" /></div><div class="about_text"></div></div></div><\!--content结束--\>',noNet:'<\!--header开始--\><div id="header" class="uh"><h1 class="ub-f1 ut-s tx-c" tabindex="0">请求出错</h1><div class="header_btn header_right" _click="location.reload();">重试</div></div><\!--header结束--\><\!--content开始--\><div id="content" class="ub-f1 clearfix login_h" style="padding:.5em 1em;color:#333;">很抱歉，请求服务器时出错。请检查您的网络或稍后再试。</div><\!--content结束--\>'},
c={mainFooter:'<\!--footer开始--\><div id="footer" class="uf c-m2 c-bla t-wh"><ul id="nav" class="clearfix ub"><li _click=\'ViewMgr.gotoPage("new");\' class="${1} ub-f1"><div class="nav_ico">商品</div></li><li _click=\'ViewMgr.gotoPage("tradeMap");\' class="${2} ub-f1"><div class="nav_ico">商户</div></li><li _click=\'ViewMgr.gotoPage("activity");\' class="${3} ub-f1"><div class="nav_ico">活动</div></li><li _click=\'ViewMgr.gotoPage("more");\' class="${4} ub-f1"><div class="nav_ico" id="footer_unread">更多</div></li></ul></div>',
productFooter:'<\!--footer开始--\><div id="footer" class="uf c-m2 c-bla t-wh"><div id="nav" class="ub clearfix"><li class="keep_ico ub-f1" id="collect_btn" _click=\'UserAction.collect(this)\'><div class="nav_ico">收藏</div></li><li class="chat_ico ub-f1" _click=\'UserAction.productComment()\'><div class="nav_ico">评论</div></li></div></div><\!--footer结束--\>',tradeFooter:'<\!--footer开始--\><div id="footer" class="uf c-m2 c-bla t-wh"><div id="nav" class="ub clearfix"><li class="chat_ico ub-f1" _click=\'UserAction.productComment()\'><div class="nav_ico">评论</div></li></div></div><\!--footer结束--\>'},
d={login:[!1,!1,function(){DOM.addEvent($("#password"),"keypress",function(a){13==a.keyCode&&($("#password").blur(),UserAction.checkLogin("#nickname","#password",$("#loginBtn")))});var a=Mix.base.storage.get("kxjy_my_nick"),b=Mix.base.storage.get("kxjy_my_pwd");if(a&&b)$("#nickname").value=a,$("#password").value=b},!0],regist:[!1,!1,null,!0],password:[!1,!1],"new":["mainFooter",1,function(){UserAction.getRecommend(UserTools.swipeView)}],sale:["mainFooter",1,function(){UserAction.getSaleTitle(ViewMgr.tmpParams,
function(a){var b=a.list,a=Mix.base.htmlEncodeObj(a.maincategory),c=UserTools.getParamVal("subCid")||a.cid;$("#sale_title").innerHTML=a.category_name;b.unshift({cid:a.cid,category_name:"全部"});$("#saleTitle").innerHTML="";if(b.length>5)$(".product_nav>div").style.width=Math.ceil(b.length*$(".product_nav").offsetWidth/5)+"px",WIN.titleScroll=new Mix.scroll(".product_nav",{vScroll:!1,hScroll:!0,onBeforeStart:function(){}});b.forEach(function(a){var b=DOM.create("li",{innerHTML:a.category_name+" ",className:c==
a.cid?"select":""});b.style.width=Math.ceil($(".product_nav").offsetWidth/5-1)+"px";b.setAttribute("_click","UserAction.setSaleTitle('"+a.cid+"')");b.setAttribute("cid",a.cid);$("#saleTitle").appendChild(b)})})}],product:["productFooter",null,function(){UserAction.sendAction(StorMgr.siteUrl+"?r=api/item/itemdetail&ajax=1&callback=?",ViewMgr.tmpParams,null,function(a){a=Mix.base.htmlEncodeObj(a);$("#product_name").innerHTML=a.item_name||"商品名称";var b=a.pic_index;$("#product_img").setAttribute("src",
b);$("#product_img").setAttribute("_click",'Device.imageBrowser("'+b+'")');$(".product_price").innerHTML="￥"+(a.price||"价格不详");$(".product_info>p").innerHTML=a.description||"暂无描述";var b=a.piclist,c="";if(b&&b.length>0)$.each(b,function(a){c+='<img src="'+a.pic_url+'" alt="产品图" _click="Device.imageBrowser(\''+a.pic_url+"')\" />"}),$("#product_img_list").innerHTML=c;if(0!=a.user_favorite*1)DOM.addClass($("#collect_btn"),"select"),$("#collect_btn").firstElementChild.innerHTML="取消收藏"})}],comment:[!1,
!1,function(){function a(){var c=$("#comment_input");if(c)c=c.value.chineseLen(),c>150?$("#content .limit").innerHTML="<span style='color:red'>超出最大字数限制</span>":$("#content .limit").innerHTML="还可以输入<span>"+(b-c)+"</span>字",setTimeout(a,500)}var b=150;setTimeout(a,500)}],commentList:[!1,!1,null],tradeMap:["mainFooter",2,function(){$("#trade_map").style.height=$("#content").offsetHeight+"px";Mix.map.init({cont:"trade_map",pointArr:StorMgr.gpsInfo?[StorMgr.gpsInfo.lng,StorMgr.gpsInfo.lat]:[121.491,31.233],
slide:!0})}],tradeList:["mainFooter",2,function(){Mix.map.setSlide(1E4)}],tradePage:["tradeFooter",null,function(){var a=StorMgr.siteUrl+"?r=api/branch/detail/branch/"+UserTools.getParamVal("itemid")+"&ajax=1&callback=?";UserAction.sendAction(a,ViewMgr.tmpParams,null,function(a){var a=Mix.base.htmlEncodeObj(a),b=a.branch_name||"商户名称";$("#trade_name").innerHTML=b;var c=a.pic_index;$("#trade_pic").setAttribute("src",c);$("#trade_name_2").innerHTML=b;$("#trade_desc").innerHTML=a.description||"暂无描述";
$(".trade_like_btn").innerHTML=0==a.user_attention*1?"关注":"取消关注";$("#address").innerHTML="地址："+(a.address||"暂无地址");$("#traffic").innerHTML="轨交："+(a.traffic||"暂无交通提示");$("#tell").innerHTML=a.tel||"暂无电话";$("#showTradeMap").setAttribute("lnglat",a.latitude_longitude)})}],tradeMapNavi:[!1,!1,function(){$("#trade_map").style.height=$("#content").offsetHeight+"px";(lnglat=UserTools.getParamVal("lnglat"))?lnglat=[lnglat.split(",")[1],lnglat.split(",")[0]]:(toast("商户信息未获取完毕，无法查看地图"),lnglat=[121.491,31.233]);
Mix.map.init({con:"trade_map",slide:!1,pointArr:lnglat,level:11,addMark:!0})}],tradePic:[!1,!1,function(){}],activity:["mainFooter",3,function(){}],activityInfo:[!1,!1,function(){var a=StorMgr.siteUrl+"?r=api/action/detail&ajax=1&callback=?&type=3&id="+UserTools.getParamVal("itemid");UserAction.sendAction(a,null,null,function(a){a=a.info;$("#activityInfo_title").innerHTML=a.title||"活动详情";$("#activityInfo_content").innerHTML=a.content||"暂无活动详情"})}],more:["mainFooter",4,function(){StorMgr.getMyInfo(!0,
function(){var a=StorMgr.myInfo;$("#attention_num").innerHTML=a.attention_num||0;$("#favorite_num").innerHTML=a.favorite_num||0;if(a.message_unread_num*1)$("#systemMsg_un").innerHTML='系统消息<span class="more_red">'+a.message_unread_num+"</span>"})}],myAccount:[!1,!1,function(){function a(){var b=StorMgr.myInfo;$("#myAccount_nickname").innerHTML=b.nickname||"";$("#myAccount_email").value=b.email||""}StorMgr.myInfo?a():StorMgr.getMyInfo(!0,a)}],attentionTrade:[!1,!1,function(){}],favoriteProduct:[!1,
!1,function(){}],integral:[!1,!1,function(){function a(){var b=StorMgr.myInfo;$("#integral_point").innerHTML=b.point||0}StorMgr.myInfo?a():StorMgr.getMyInfo(!0,a)}],systemMsg:[!1,!1],opinion:[!1,!1],noNet:[!1,!1],about:[!1,!1,function(){UserAction.sendAction(StorMgr.siteUrl+"?r=api/about/about&ajax=1&callback=?",null,null,function(a){$(".about_text").innerHTML=a.about})}]},f=function(a){this.destroy();this.options={pageWrap:$("#pageWraper"),animate:!1};extend(this.options,a)};f.prototype={initUser:function(){if(/login/.test(this.curPage))this.hasUser=
!1;else if(!this.hasUser)this.hasUser=!0},replacePubTmpl:function(b){b=b.replace(/\$\{headerCancel\}/,a);b=b.replace(/\$\{headerBack\}/,'<\!--header开始--\><div id="header" class="uh"><div class="header_btn header_left" _click="ViewMgr.back()"><img src="css/images/return.png" alt="返回"/></div>');b=b.replace(/\$\{headerSearch\}/,'<\!--header开始--\><div id="header" class="uh"><div class="kxjy-hd"><div _click="UserMenus(\'search\')" class="btn btn-l kxjy-btn ub ub-ac "><span class="header-ico hd-search"></span></div>');
return b=b.replace(/\$\{siteurl\}/g,StorMgr.siteUrl)},compileTmpl:function(){var a=this.curPage,f=d[a],i=f[0]?c[f[0]]:!1,j=f[1],a=b[a],i=i?i:"";f[3]?DOM.addClass(BODY,"bg"):DOM.removeClass(BODY,"bg");a=this.replacePubTmpl(a);j&&(f=RegExp("\\$\\{\\d+\\}","g"),i=i.replace(RegExp("\\$\\{"+j+"\\}","g"),"select"),i=i.replace(f,""));return a+i},cancelPrePage:function(){var a=!1;["comment","login","password"].has(this.curPage)&&(UserTools.fixHighlight(),a=!0);if("new"==this.curPage&&UserTools.gallery)UserTools.gallery.destroy(),
UserTools.gallery=null;if(this.checkHeight)clearTimeout(this.checkHeight),this.checkHeight=null;if(this.delayInter)clearTimeout(this.delayInter),this.delayInter=null;UserAction.stop();Mix.ui.tips.destroy();Device.destroy();Mix.obs.clear("resize");return a},initPage:function(a,b){var c=this,d=!1;(d=c.cancelPrePage())?c.delayInter=setTimeout(function(){c._initPage(a,b)},200):c._initPage(a,b)},_initPage:function(a,b){this.prePage=this.curPage;this.curPage=a;this.initUser();var c=this.compileTmpl(),f=
this.options.pageWrap;this.options.animate&&this.prePage!=this.curPage?this.animate(b,c):(f.innerHTML="",f.innerHTML=c,this.fireEvent());"mainFooter"==d[this.curPage][0]&&StorMgr.getMyInfo(!0,function(a){if(a.message_unread_num*1&&$("#footer_unread"))$("#footer_unread").innerHTML='更多<span class="has">'+a.message_unread_num*1+"</span></div>"})},animate:function(a,b){$("#fackWrap")&&BODY.removeChild($("#fackWrap"));var c=this.options.pageWrap,d=c.cloneNode(!0);BODY.appendChild(d);d.id="fackWrap";c.innerHTML=
b;c.style.left="right"==a?"-"+c.offsetWidth+"px":c.offsetWidth+"px";this.fireEvent();BODY.style[Mix.transitionProperty]=Mix.cssPrefix+"transform";BODY.style[Mix.transitionDuration]="300ms";setTimeout(function(){BODY.style[Mix.transform]="right"==a?"translateX("+c.offsetWidth+"px)":"translateX(-"+c.offsetWidth+"px)"},0);setTimeout(function(){c.style.left="0";BODY.style[Mix.transitionDuration]="0";BODY.style[Mix.transform]="translateX(0)";d&&BODY.removeChild(d);delete d},300)},fireEvent:function(){var a=
d[this.curPage][2];$.isFunc(a)&&a.call(null);this.initIScrollAndFeed()},initIScrollAndFeed:function(){var a=this,b={page:a.curPage,cont:$(".new_list_box"),threeWrap:!1,onAppend:function(){a.checkContent()},cb:function(){WIN.myScroll&&myScroll.refresh()}};WIN.myScroll&&(myScroll.destroy(),myScroll=null);switch(a.curPage){case "new":b.threeWrap=!0;Feed.init(b);break;case "sale":b.threeWrap=!0;b.autoLoad=!0;b.addParam="cid="+(UserTools.getParamVal("subCid")||UserTools.getParamVal("cid")||"");b.onAppend=
function(){a.checkContent()};WIN.myScroll=refreshIScroll($(".pullDown"),"#content");Feed.init(b);a.scrollCb();break;case "product":case "tradePage":case "commentList":if("commentList"==a.curPage)b.autoLoad=!0;b.cont=$(".comment_list");b.cb=function(){if($(".comment_title"))$(".comment_title").innerHTML="评论(共"+myFeed.dataCount+"条)";WIN.myScroll&&myScroll.refresh()};Feed.init(b);break;case "tradeList":b.cont=$(".trade_list");Feed.init(b);break;case "activity":b.autoLoad=!0;b.cont=$(".coupon_list");
Feed.init(b);break;case "attentionTrade":b.noDataStr="暂无关注商户";b.autoLoad=!0;b.cont=$("#attentionTrade_list");Feed.init(b);break;case "favoriteProduct":case "tradePic":if("favoriteProduct"==a.curPage)b.noDataStr="暂无收藏";b.autoLoad=!0;b.threeWrap=!0;b.cont=$(".new_list_box");Feed.init(b);break;case "systemMsg":b.autoLoad=!0,b.cont=$(".system_box ol"),Feed.init(b)}b.autoLoad&&!WIN.myScroll?a.checkHeight=setTimeout(function(){WIN.myScroll=new Mix.scroll("#content");a.scrollCb()},200):(a.checkContent(),
["tradeMap","tradeMapNavi"].has(a.curPage)||DOM.addEvent($("#content"),START_EV,function(){a.checkContent()}))},checkContent:function(){var a=this;if(!WIN.myScroll)a.checkHeight=setTimeout(function(){UserTools.checkScroll("#content",a.scrollCb)},200)},scrollCb:function(){if(myFeed&&myFeed.autoLoad&&myScroll&&!myScroll.options.onMoveEnd)myScroll.options.onMoveEnd=function(){this.y<=-(myScroll.options.topOffset||0)&&this.y<=this.maxScrollY&&myFeed.loadMore()}},display:function(){},destroy:function(){this.curPage=
"login";this.prePage=null;this.hasUser=!1}};window.PageEngine=f})();var AdiApp={init:function(){HEAD=$("head");BODY=DOC.body;BODYFS=parseInt(getComputedStyle(BODY).fontSize);UserTools.getGpsInfo();StorMgr.siteUrl="http://e.kxjy.com/index.php";ViewMgr.init();Device.menuFunc=function(){UserMenus("menuBtn")};var a;DOM.addEvent(WIN,RESIZE_EV,function(){Date.now()-a<50||(a=Date.now(),Mix.obs.publish("resize"))})}};Mix.ui.loading.show($("#pageWraper"));Device.onLoad(AdiApp.init);
var ViewMgr={tmpParams:"",recordLen:10,pageParams:{},init:function(){delete WIN.pageEngine;Device.disetBackBtn();WIN.pageEngine=new PageEngine;ViewMgr.views=["login"];var a=Mix.base.storage.get("kxjy_my_nick"),b=Mix.base.storage.get("kxjy_my_pwd"),c=function(){pageEngine.initPage("login");Mix.base.storage.remove("kxjy_view_history","session")};a&&b?UserAction.sendLogin(a,b,null,null,c):c();Device.backFunc=[function(){ViewMgr.back()}]},gotoPage:function(a,b){var c=!1,d=ViewMgr,a=a.replace(".html",
""),f=d.views.length;d.views[f-2]==a?(d.views.pop(1),c=!0):(f>=d.recordLen&&d.views.shift(1),d.views.push(a));Mix.base.storage.set("kxjy_view_history",ViewMgr.views,"session");try{1==d.views.length?Device.disetBackBtn():Device.setBackBtn()}catch(g){}b?(ViewMgr.tmpParams=b,this.pageParams[a]=b):(ViewMgr.tmpParams="",this.pageParams[a]="");d.setUrl(a,b,c)},setUrl:function(a,b,c){c?pageEngine.initPage(a,"right"):pageEngine.initPage(a)},back:function(a){function b(){d&&c.gotoPage(d,c.pageParams[d])}var c=
ViewMgr,d=c.views[c.views.length-2];a?setTimeout(b,500):b()}},StorMgr={myInfo:null,destroy:function(){StorMgr.myInfo=null},getMyInfo:function(a,b){var c=this,d=StorMgr.siteUrl+"?r=api/user/info&ajax=1&callback=?&sid="+StorMgr.sid;!a&&c.myInfo?b&&b(c.myInfo):(c.myInfo&&b&&b(c.myInfo),UserAction.sendAction(d,null,null,function(a){c.myInfo=a;b&&b(a)}))}},regExpObj={email:/^.+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/,directCity:/北京|上海|重庆|天津|香港|澳门/,noLngLatCity:/马鞍山|朝阳|白沙|保亭|昌江|陵水|五指山|乐东|平顶山|临沧|普洱|双鸭山/},UserAction=
{x:null,stop:function(){this.removeLoading(!0);this.sendingResetPwd=this.sendingRegist=this.sendingLogin=!1;this.x&&this.x.abort()},checkLogin:function(a,b,c){a=$(a).value;b=$(b).value;a.length==0?toast("请输入您的昵称！",2):b.length==0?toast("请输入您的密码！",2):UserAction.sendLogin(a,b,c)},sendLogin:function(a,b,c,d,f){if(!UserAction.sendingLogin){var c=StorMgr.siteUrl+"?r=api/user/login&ajax=1&callback=?&registertype=4&brand_id=1",g="nickname="+encodeURIComponent(a)+"&password="+encodeURIComponent(b);StorMgr.gpsInfo&&
(g+="&latitude="+StorMgr.gpsInfo.lat+"&longitude="+StorMgr.gpsInfo.lng);UserAction.sendingLogin=!0;UserAction.sendAction(c,g,"get",function(c){UserTools.refresh();Mix.base.storage.set("kxjy_my_nick",a);Mix.base.storage.set("kxjy_my_pwd",b);StorMgr.sid=c.sid;StorMgr.uid="31";ViewMgr.gotoPage("new");$.isFunc(d)&&d();Device.setMenuBtn();UserAction.sendingLogin=!1},function(a){$.isFunc(f)?f(a.errStr):toast(a.errStr);UserAction.sendingLogin=!1})}},userRegist:function(){var a=$("#regEmail").value,b=$("#regNickName").value,
c=$("#regPwd").value,d=$("#regPwdR").value;this._userRegist(a,b,c,d)},_userRegist:function(a,b,c,d){if(!UserAction.sendingRegist){var f=StorMgr.siteUrl+"?r=api/user/register&ajax=1&callback=?&registertype=4&brand_id=1",g=function(a){0!=a.errCode*1?(toast(a.errStr),UserAction.sendingRegist=!1):(toast("注册成功。",0.6),setTimeout(function(){UserAction.sendingRegist=!1;UserAction.sendLogin(b,c)},500))},h=function(a){if(0!=a.errCode*1)toast(a.errStr),UserAction.sendingRegist=!1};try{if(0==b.length)throw{msg:"请输入您的昵称"};
if(b.chineseLen()>50)throw{msg:"昵称超过指定长度"};if(/\s+/.test(b))throw{msg:"昵称中不得使用空格"};if(0==a.length)throw{msg:"请输入您的邮箱地址"};if(!regExpObj.email.test(a))throw{msg:"邮箱地址有误"};if(/\s+/.test(b))throw{msg:"昵称中不得使用空格"};if(0==c.trim().length)throw{msg:"请输入您的密码"};if(c!=d)throw{msg:"两次密码不一致"};var i=encodeURIComponent(b),j=encodeURIComponent(c);f+="&nickname="+i+"&password="+j+"&email="+a;StorMgr.gpsInfo&&(f+="&latitude="+StorMgr.gpsInfo.lat+"&longitude="+StorMgr.gpsInfo.lng);UserAction.sendingRegist=!0;UserAction.sendAction(f,
"","get",g,h)}catch(k){toast(k.msg)}}},changePwd:function(){var a=$("#password_val").value.trim(),b=StorMgr.siteUrl+"?r=api/user/getPassword&callback=?&email=";0==a.length?toast("请输入您的邮箱地址"):regExpObj.email.test(a)?(b+=encodeURIComponent(a),UserAction.sendAction(b,null,null,function(){toast("发送成功,请检查你的邮箱。")})):toast("邮箱地址有误")},sendFeedBack:function(a,b){if(!UserAction.sendingFeedBack){var c=StorMgr.siteUrl+"?r=api/feedback/add&ajax=1&callback=?",d=a.value,f=b.value;0==d.trim().length||0==f.trim().length?
toast("发送内容和联系方式不能为空！",2):(UserAction.sendingFeedBack=!0,UserAction.sendAction(c,"content="+encodeURIComponent(d)+"&tel="+encodeURIComponent(f),"post",function(){toast("提交成功!",1);setTimeout(function(){ViewMgr.back()},1E3);UserAction.sendingFeedBack=!1},function(a){toast(a.errStr,2);UserAction.sendingFeedBack=!1}))}},getRecommend:function(a){UserAction.sendAction(StorMgr.siteUrl+"?r=api/hotcontent/list&ajax=1&callback=?&page=1&num=5",null,"get",function(b){b.list&&b.list.length>0&&a(b.list)})},collect:function(a){function b(){Device.alert("取消收藏成功",
"商品名称:"+$("#product_name").innerHTML,"知道了");DOM.removeClass(a,"select");f.innerHTML="收藏"}var c=StorMgr.siteUrl+"?r=api/UserFavorite/add&ajax=1&callback=?",d=function(){Device.alert("收藏成功","商品名称:"+$("#product_name").innerHTML,"知道了");DOM.addClass(a,"select");f.innerHTML="取消收藏"},f=a.firstElementChild;DOM.hasClass(a,"select")&&(c=StorMgr.siteUrl+"?r=api/UserFavorite/delete&ajax=1&callback=?",d=b);c+="&item_id="+UserTools.getParamVal("itemid");UserAction.sendAction(c,null,"get",d)},productComment:function(){ViewMgr.gotoPage("comment",
"itemid="+UserTools.getParamVal("itemid")+"&type="+UserTools.getParamVal("type"))},productShare:function(){toast("暂未提供分享功能")},gotoCommentList:function(){ViewMgr.gotoPage("commentList","itemid="+UserTools.getParamVal("itemid")+"&type="+UserTools.getParamVal("type"))},attentionTrade:function(a){function b(){Device.alert("取消关注成功","商户名称:"+$("#trade_name").innerHTML,"知道了");a.innerHTML="关注"}var c=StorMgr.siteUrl+"?r=api/UserAttention/add&ajax=1&callback=?",d=function(){Device.alert("关注成功","商户名称:"+$("#trade_name").innerHTML,
"知道了");a.innerHTML="取消关注"};"关注"!=a.innerHTML&&(c=StorMgr.siteUrl+"?r=api/UserAttention/delete&ajax=1&callback=?",d=b);c+="&branch_id="+UserTools.getParamVal("itemid");UserAction.sendAction(c,null,"get",d)},showTradeMap:function(){var a=$("#showTradeMap").getAttribute("lnglat");ViewMgr.gotoPage("tradeMapNavi","lnglat="+a)},showTradeTell:function(){var a=$("#tell").innerHTML;"暂无电话"!=a?(a=a.replace(/[^\d]/g,""),Device.dial(a)):toast("该商户暂未提供电话号码")},showTradeFavo:function(){ViewMgr.gotoPage("activity",
"itemid="+UserTools.getParamVal("itemid")+"&type=3")},getTradePic:function(){ViewMgr.gotoPage("tradePic","itemid="+UserTools.getParamVal("itemid")+"&type=2")},sendComment:function(a){var b=a.value.chineseLen();b>150||b==0?Device.alert("发表评论出错","评论内容不得为空或超过150个字。","我知道了"):(b=StorMgr.siteUrl+"?r=api/comment/add&ajax=1&callback=?&nid="+UserTools.getParamVal("itemid")+"&type="+(UserTools.getParamVal("type")||1)+"&content="+encodeURIComponent(a.value),UserAction.sendAction(b,null,"get",function(){toast("评论成功。",
800);a.value="";setTimeout(function(){UserAction.gotoCommentList()},800)}))},checkAppVersion:function(){Device.alert("检测完成","您当前为最新版本。","我知道了")},logOut:function(){Device.confirm("确定注销用户？",function(){UserTools.refresh();Mix.base.storage.clear("session");Mix.base.storage.clear();ViewMgr.init();Device.disetMenuBtn()},null,null,"注销提示")},getSaleTitle:function(a,b){UserAction.sendAction(StorMgr.siteUrl+"?r=api/itemCategory/list&ajax=1&callback=?",a,null,function(a){0!=a.errCode?toast(a.errStr):b(a)})},
setSaleTitle:function(a){/subCid=[^&]*/.test(ViewMgr.pageParams.sale)?ViewMgr.pageParams.sale=ViewMgr.pageParams.sale.replace(/subCid=[^&]*/,"subCid="+a):ViewMgr.pageParams.sale+="&subCid="+a;ViewMgr.tmpParams=ViewMgr.pageParams.sale;var b=$$(".product_nav li");DOM.removeClass(b,"select");$.each(b,function(b){b.getAttribute("cid")==a&&DOM.addClass(b,"select")});Feed.refresh("cid="+a);myFeed.addParam="cid="+a},config:function(){},setEmail:function(a){var b=StorMgr.siteUrl+"?r=api/user/setEmail&ajax=1&callback=?&sid="+
StorMgr.sid,c=a.value;0==c.length?toast("请输入您的邮箱地址"):regExpObj.email.test(c)?UserAction.sendAction(b,"email="+c,null,function(){toast("邮箱变更成功。");StorMgr.myInfo.email=c}):toast("邮箱地址有误")},sendAction:function(a,b,c,d,f){var g=this,h=new Mix.x({method:c||"get",dataType:"json"});g.addLoading();h.onLoad=function(){g.removeLoading();var a=h.response;if(a.errCode&&a.errCode*1!=0)f?f(a):toast(a.errStr);else try{d&&d(a)}catch(b){}};h.onFail=function(){g.removeLoading();f&&h.response?f(h.response):pageEngine.initPage("noNet")};
!/sid=/.test(a)&&StorMgr.sid&&(a+="&sid="+StorMgr.sid);h.send(a,b);return g.x=h},addLoading:function(){UserAction.LoadingCount=UserAction.LoadingCount||0;UserAction.LoadingCount++;Mix.ui.loading.show($("content"),function(){UserAction.LoadingCount=0;Mix.ui.loading.hide();toast("请求服务器超时。请检查网络或稍后再试。",5)},10)},removeLoading:function(a){UserAction.LoadingCount--;if(a||0>=UserAction.LoadingCount)UserAction.LoadingCount=0,Mix.ui.loading.hide()}},UserTools={refresh:function(){Mix.base.storage.clear("session");
StorMgr.destroy();UserTools.endPreLoad=!0;UserTools.preLoadInter&&clearTimeout(UserTools.preLoadInter)},getParamVal:function(a){var b="",c=ViewMgr.tmpParams.split("&");0!=c.length&&$.each(c,function(c){var f=RegExp(a+"=(.*)");f.test(c)&&(b=f.exec(c)[1])});return b},initArea:function(a,b,c){if(StorMgr.gpsInfo&&StorMgr.gpsInfo.prov&&StorMgr.gpsInfo.city)b=StorMgr.gpsInfo.prov,c=StorMgr.gpsInfo.city;if(Mix.map.searchProv)b=Mix.map.searchProv,c="";if(Mix.map.searchCity)c=Mix.map.searchCity;var d={useMask:!0,
onConfirm:function(b,c){b?a(b,c):toast("未选择地区",2)},onShow:function(a){Device.backFunc.unshift(function(){a.hide()})},hideEnd:function(){Device.backFunc.shift(0);if(Device.backFunc.length<=0)Device.backFunc=[function(){ViewMgr.back()}]}};if(b)d.prov=b;if(c&&!regExpObj.directCity.test(c))d.city=c;Mix.ui.region.show(d)},getGpsInfo:function(a){StorMgr.gpsInfo=Mix.base.storage.get("kxjy_my_gpsInfo");Device.getLocation(function(b,c){var d={lat:b,lng:c};StorMgr.gpsInfo=d;Mix.base.storage.set("kxjy_my_gpsInfo",
d);Mix.map.getProvCity(c,b,StorMgr.gpsInfo);$.isFunc(a)&&a()})},distence:function(a,b){for(var c=[],d=Math,f=d.PI,g=b[1]*f/180,h=b[0]*f/180-a[0]*f/180,i=0,j=d.atan(0.996647189328169*d.tan(a[1]*f/180)),k=d.atan(0.996647189328169*d.tan(g)),g=d.cos(j),n=d.cos(k),j=d.sin(j),k=d.sin(k),v=g*n,w=j*k,q=0,l=0,o=0,m=0,r=0,p=0,s=0,t=0,m=h,x=0;x<20;x++){var z=m,s=d.cos(m),t=d.sin(m),i=n*t,q=g*k-j*n*s,p=d.sqrt(i*i+q*q),r=w+v*s,q=d.atan2(p,r),u=p==0?0:v*t/p,o=1-u*u,m=o==0?0:r-2*w/o,l=o*0.006739496756586903,i=1+
l/16384*(4096+l*(-768+l*(320-175*l))),l=l/1024*(256+l*(-128+l*(74-47*l))),o=2.0955066698943685E-4*o*(4+0.0033528106718309896*(4-3*o)),y=m*m,l=l*p*(m+l/4*(r*(-1+2*y)-l/6*m*(-3+4*p*p)*(-3+4*y))),m=h+(1-o)*0.0033528106718309896*u*(q+o*p*(m+o*r*(-1+2*m*m)));if(d.abs((m-z)/m)<1.0E-12)break}c[0]=6356752.3142*i*(q-l);c.length>1&&(h=d.atan2(n*t,g*k-j*n*s),h*=180/f,c[1]=h,c.length>2&&(d=d.atan2(g*t,-j*n+g*k*s),d*=180/f,c[2]=d));return c},checkScroll:function(a,b){if($(a)&&!WIN.myScroll&&$(a+">div")&&$(a+">div").offsetHeight>
$(a).offsetHeight)WIN.myScroll=["comment","login","regist","tradeList","myAccount"].has(pageEngine.curPage)?new Mix.scroll(a,{useTransform:!1}):new Mix.scroll(a),b&&b()},fixHighlight:function(){DOC.activeElement.blur()},swipeViewClick:function(){var a=UserTools.slides[UserTools.gallery.pageIndex];switch(a.type*1+1||1){case 1:ViewMgr.gotoPage("product","itemid="+a.nid+"&type=1");break;case 2:ViewMgr.gotoPage("tradePage","itemid="+a.nid+"&type=2");break;case 3:ViewMgr.gotoPage("activityInfo","itemid="+
a.nid+"&type=3")}},swipeView:function(a){function b(){var a=$("#switch_img img").offsetHeight;$("#switch_img").style.height=a+"px";$(".switch").style.height=a+"px";$(".new_list_box").style.paddingTop=a+5+"px"}function c(a,c){var d;c?(d=c,d.src=a.pic):(d=DOM.create("img",{className:"loading",src:a.pic}),d.onload=function(){this.className="";b()});d.width="100%";return d}function d(){$("#switch_img")?(UserTools.gallery&&UserTools.gallery.next(),UserTools.galleryInter=setTimeout(d,5E3)):(clearTimeout(UserTools.galleryInter),
UserTools.gallery&&UserTools.gallery.destroy())}var f,g,h;h="";UserTools.slides=a;g=0;for(var i=a.length;g<i;g++)g==0?h='<li class="active"></li>':h+="<li></li>";$(".switch").innerHTML='<div id="switch_img" class="switch_img"></div><ol id="switch_nav" class="switch_number ub"></ol>';$("#switch_nav").innerHTML=h;var j=$$("#switch_nav li");f=new Mix.swipeView("#switch_img",{numberOfPages:a.length});Mix.obs.subscribe("resize",function(){f.__resize();b()});for(h=0;h<3;h++)g=h==0?a.length-1:h-1,g=c(a[g]),
f.masterPages[h].appendChild(g);f.onFlip(function(){var b,g,h;for(h=0;h<3;h++)g=f.masterPages[h].dataset.upcomingPageIndex,g!=f.masterPages[h].dataset.pageIndex&&(b=$("img",f.masterPages[h]),c(a[g],b));DOM.removeClass($("#switch_nav .active"),"active");DOM.addClass(j[f.pageIndex],"active");clearTimeout(UserTools.galleryInter);UserTools.galleryInter=setTimeout(d,5E3)});UserTools.galleryInter&&clearTimeout(UserTools.galleryInter);UserTools.galleryInter=setTimeout(d,5E3);UserTools.gallery=f},drawRoute:function(){var a,
b;b=UserTools.getParamVal("lnglat");a=Mix.map.clickPoint?new BMap.Point(Mix.map.clickPoint[0],Mix.map.clickPoint[1]):StorMgr.gpsInfo?new BMap.Point(StorMgr.gpsInfo.lng,StorMgr.gpsInfo.lat):new BMap.Point(121.488161,31.243282);b=b?[b.split(",")[1],b.split(",")[0]]:[121.491,31.233];b=new BMap.Point(b[0],b[1]);Mix.map.walkingRoute(a,b)},preLoadResource:function(a,b,c){function d(){i||(clearTimeout(UserTools.preLoadInter),c&&BODY.removeChild(j),BODY.removeChild(f),UserAction.removeLoading(),i=!0)}UserTools.endPreLoad=
!1;if(a.length<=0)b&&b();else{var f=DOM.create("div",{style:{position:"absolute",height:"0",left:"10000em"}}),g=0,h=a.length;Date.now();var i=!1;UserTools.preLoadInter=setTimeout(function(){d()},1E4);BODY.appendChild(f);UserAction.addLoading();if(c){var j=DOM.create("div",{className:"ui_progress"}),k=DOM.create("div",{className:"inner"}),n=DOM.create("div",{className:"text"});j.appendChild(k);j.appendChild(n);BODY.appendChild(j)}$.each(a,function(a){var i=new Image;i.src=a;i.onload=function(){if(UserTools.endPreLoad)d();
else{g++;if(c){var a=Math.ceil(g*100/h)+"%";n.innerHTML=a;k.style.width=a}if(g>=h){if(c)j.style.opacity=0;UserTools.endPreLoad||b&&b();d()}}};f.appendChild(i)})}},getUrlVal:function(a,b){var c=RegExp(b+"=([^&]+)");if(c.exec(a))return c.exec(a)[1];return null}};
function UserMenus(a){var b={pos:"middle",onShow:function(a){Device.backFunc.unshift(function(){a.hide()})},hideEnd:function(){Device.backFunc.shift(0);if(Device.backFunc.length<=0)Device.backFunc=[function(){ViewMgr.back()}]}};switch(a){case "menuBtn":b.pos="bottom";b.items=["注销用户","退出应用"];b.onSelect=function(a){switch(a*1){case 0:UserAction.logOut();break;case 1:Device.exit()}};break;case "map":b.title="地图操作",b.direct="vertical",b.items=["点选你的位置","取消"],b.onSelect=function(a){switch(a*1){case 0:Mix.map.clickSelect=
!0;break;case 1:Mix.map.clickSelect=!1}}}Mix.ui.menu.show(b)}
function refreshIScroll(a,b,c){var d=a.offsetHeight,b=new Mix.scroll(b,{bounce:!0,useTransform:!1,topOffset:d,onRefresh:function(){if(DOM.hasClass(a,"loading"))DOM.removeClass(a,"loading"),$(".pullDownLabel",a).innerHTML="下拉刷新页面..."},onMove:function(){if(this.y>5)$(".pullDownIcon")&&($(".pullDownIcon").style.webkitTransform="rotate(-180deg)"),$(".pullDownLabel",a).innerHTML="释放刷新页面...",this.minScrollY=0;else if(this.y<5){if($(".pullDownIcon"))if(this.y>-d/2&&this.y<=0){var b=-180*(2*this.y/d-1);$(".pullDownIcon").style.webkitTransform=
"rotate("+b+"deg)"}else if(this.y<-d/2)$(".pullDownIcon").style.webkitTransform="rotate(0deg)";DOM.removeClass(a,"flip");$(".pullDownLabel",a).innerHTML="下拉刷新页面...";this.minScrollY=-d}},onScrollEnd:function(){if($(".pullDownLabel",a).innerHTML=="释放刷新页面...")DOM.addClass(a,"loading"),$(".pullDownLabel",a).innerHTML="载入中...",$.isFunc(c)?c():Feed.refresh()}});setTimeout(function(){$("#content").style.left="0"},100);return b}
Mix.map={init:function(a){function b(){c.bM=new BMap.Map("trade_map");c.raduis=c.raduis||1E4;var a=new BMap.Point(d.pointArr[0],d.pointArr[1]),b=c.setLevel(d.raduis);c.level=b;c.bM.curPoint=a;c.bM.centerAndZoom(a,b);d.slide&&(c.setSlide(d.raduis),Mix.obs.subscribe("map_slide",function(a,b){c.slideMove(b)}),Mix.obs.subscribe("map_slide_end",function(a,b){c.slideMoveEnd(b)}));c.searchStr=d.searchStr;c.bM.addEventListener("click",function(a){c.clickHd(a)});c.bM.addEventListener("dragend",function(){c.bM.curPoint=
c.bM.getCenter()});Mix.obs.subscribe("resize",function(){c.refresh()});d.addMark?c.addMarker(d.pointArr[1],d.pointArr[0],!0):c.searchProv?c.gotoCity(c.searchProv,c.searchCity,!0):c.viewSearch()}var c=this,d={con:"trade_map",slide:!1,pointArr:[121.491,31.233],raduis:1E4,addMark:!1,searchStr:null};extend(d,a);c.clickPoint=null;c.clickSelect=!1;c.preProv=null;WIN.BMap?b():(a=Mix.base.storage.get("reload_baidu_map_time"))&&parseInt(a)>2?(toast("多次重启应用依然无法加载百度地图。很抱歉给您的使用带来不便。",5),Mix.base.storage.remove("reload_baidu_map_time")):
(toast("未加载地图资源，无法打开百度地图。将尝试重新启动应用。",5),a=a?parseInt(a)+1:1,Mix.base.storage.set("reload_baidu_map_time",a),setTimeout(function(){location.reload()},3E3))},refresh:function(){var a=this;$("#trade_map").style.height=$("#content").offsetHeight+"px";a.bM.checkResize();$("#ui_slide")&&setTimeout(function(){a.setSlide(a.raduis)},0)},setCity:function(a,b){!a||!b&&!regExpObj.directCity.test(a)?toast("未选取地区"):(regExpObj.directCity.test(b)&&(b=""),this.searchProv=a,this.searchCity=b,$("#tradeMap_city").innerHTML=
[a,b].join(" "),"tradeMap"==pageEngine.curPage?this.gotoCity(a,b):(!StorMgr.gpsInfo||a!=StorMgr.gpsInfo.prov||!regExpObj.directCity.test(a)&&b!=StorMgr.gpsInfo.city?$("#ui_slide").style.display="none":$("#ui_slide").style.display="block",this.viewSearch()))},gotoCity:function(a,b,c){function d(){DOM.removeEvent(f.bM,"tilesloaded",d);f.bM.curPoint=f.bM.centerPoint;f.viewSearch();c&&f.bM.centerAndZoom(f.bM.centerPoint,f.level)}var f=this;DOM.addEvent(f.bM,"tilesloaded",d);if(regExpObj.noLngLatCity.test(b)){var g=
Mix.regions.getLngLat(a,b);if(g){a=new BMap.Point(g[0],g[1]);f.bM.setCenter(a);return}}regExpObj.directCity.test(a)?f.preProv&&f.preProv==a?d():(f.preProv=a,f.bM.setCenter(a)):f.bM.setCenter(b)},viewSearch:function(a){a?this.bM.centerAndZoom(this.bM.curPoint,this.level):"tradeMap"==pageEngine.curPage?(this.bM.clearOverlays(),this.bM.curPoint=this.bM.getCenter(),this.searchStr=null,this.getTrades()):$("#ui_slide").style.display=="none"?Feed.refresh(this.getParams()):Feed.refresh("rang="+this.raduis+
this.getParams())},getTrades:function(){var a=this,b=StorMgr.siteUrl+"?r=/api/branch/list&ajax=1&callback=?";b+=a.getParams();UserAction.sendAction(b,null,null,function(b){if(!b.errCb&&b.list&&b.list.length>0)for(var b=b.list,d=0,f=b.length,g,h;d<f;d++)h=b[d].latitude_longitude.split(",")[1],(g=b[d].latitude_longitude.split(",")[0])&&h&&a.addMarker(g,h,!0,b[d]);else toast("未读取到商户")})},getParams:function(){var a="";a+="&province="+(this.searchProv?this.searchProv:"");a+="&city="+(this.searchCity?this.searchCity:
"");if("tradeMap"==pageEngine.curPage)return a;a+="&keywords="+(this.searchStr?this.searchStr:"");if(StorMgr.gpsInfo){if(StorMgr.gpsInfo.prov!=this.searchProv)return a;a+="&latitude="+StorMgr.gpsInfo.lat;a+="&longitude="+StorMgr.gpsInfo.lng}return a},setSlide:function(a){var b=Math.round($("#ui_slide").offsetWidth*a/1E4);a==1E4&&(b=$("#ui_slide").offsetWidth-1.5*BODYFS);this.raduis=a;$("#ui_slide .trolley_bg").style.width=b+BODYFS+"px";$("#ui_slide .trolley_btn").style.left=b+"px";"tradeList"!=pageEngine.curPage?
$("#ui_slide .trolley_tips").style.display="none":$("#ui_slide .trolley_tips").innerHTML=a+"m";if(!this.searchProv&&StorMgr.gpsInfo&&StorMgr.gpsInfo.prov&&StorMgr.gpsInfo.city)this.searchProv=StorMgr.gpsInfo.prov,this.searchCity=regExpObj.directCity.test(StorMgr.gpsInfo.city)?"":StorMgr.gpsInfo.city;if(this.searchProv){if("tradeList"==pageEngine.curPage&&(!StorMgr.gpsInfo||StorMgr.gpsInfo&&StorMgr.gpsInfo.prov!=this.searchProv))$("#ui_slide").style.display="none"}else if($("#tradeMap_city").innerHTML=
"未定位","tradeList"==pageEngine.curPage)$("#ui_slide").style.display="none";if(this.searchProv||this.searchCity)$("#tradeMap_city").innerHTML=[this.searchProv,this.searchCity].join(" ")},searchString:function(a){a=a.previousElementSibling.firstElementChild.value;a.trim()?(this.searchStr=a,this.raduis=1E4):(toast("没有填写搜索内容，显示全部商户"),this.searchStr=null);this.viewSearch()},addMarker:function(a,b,c,d){b=new BMap.Point(b,a);a=new BMap.Marker(b);c||this.bM.centerAndZoom(b,20);d?(c=new BMap.Label("<p _click=\"ViewMgr.gotoPage('tradePage','itemid="+
d.branch_id+"&type=2');\">"+d.branch_name+"</p>",{offset:{width:-10,height:-30}}),a.setLabel(c)):this.bM.curPoint=b;this.bM.addOverlay(a)},clickHd:function(a){if(Mix.map.clickSelect){var b=new BMap.Point(a.point.lng,a.point.lat);new BMap.LocalSearch(b,{renderOptions:{map:this.bM}});this.addMarker(a.point.lat,a.point.lng,!0);this.clickPoint=[a.point.lng,a.point.lat];this.clickSelect=!1}},menu:function(){UserMenus("map")},slideTo:function(a){var b=(new Event(a.event)).pageX-a.offsetLeft-BODYFS*0.7;
this.setSlideBall(a.lastElementChild,b);this.slideMoveEnd()},setLevel:function(a){a*=1;return 19-Math.floor(a*8/1E4)},slideMove:function(a){this.setSlideBall(a,a.moveDist[0]+a.originPos[0])},setSlideBall:function(a,b){var c=a.parentNode.offsetWidth;b<1&&(b=1);b>c-BODYFS*1.5&&(b=c-BODYFS*1.5);c=1E4*b/(c-BODYFS*1.5);a.style.left=b+"px";a.previousElementSibling.style.width=b+BODYFS+"px";a.firstElementChild.innerHTML=Math.ceil(c)+"m";this.raduis=c},slideMoveEnd:function(){this.level=this.setLevel(this.raduis);
"tradeMap"==pageEngine.curPage?this.viewSearch(!0):Feed.refresh("rang="+this.raduis+this.getParams())},walkingRoute:function(a,b){var c=new BMap.WalkingRoute(this.bM,{renderOptions:{map:this.bM,autoViewport:!0}});this.bM.clearOverlays();c.search(a,b)},getProvCity:function(a,b,c){a=new BMap.Point(a,b);gc=new BMap.Geocoder;gc.getLocation(a,function(a){a=a.addressComponents;c.prov=a.province.replace(/[市省]/,"");c.city=a.city.replace(/[市省]/,"")})}};
var feedTemplate={"new":'<div class="new_list ub-f1" _click="ViewMgr.gotoPage(\'sale\',\'cid=${cid}\')"><div class="new_list_img"><img src="${pic}" alt="${category_name}" /><p class="new_class">${category_name}</p></div></div>',sale:'<div class="new_list ub-f1" _click="ViewMgr.gotoPage(\'product\',\'itemid=${item_id}&type=1\')"><div class="new_list_img"><img src="${pic_index}" alt="${item_name}" /><p class="new_price">￥${price}</p></div></div>',product:'<li><div class="comment_time ub ub-ac"><div class="comment_name ub-f1"><span>${nickname}</span>说：</div><strong>${update_time}</strong></div><div class="comment_text ub" _click="UserAction.gotoCommentList()"><p class="ub-f1">${content}</p><div class="comment_more"><img src="css/images/arrow.png" alt="更多" /></div></div></li>',
commentList:'<li><div class="comment_time ub ub-ac"><div class="comment_name ub-f1"><span>${nickname}</span>说：</div><strong>${update_time}</strong></div><div class="comment_text ub"><p class="ub-f1">${content}</p></div></li>',tradeList:'<div class="trade_like ub" _click="ViewMgr.gotoPage(\'tradePage\',\'itemid=${branch_id}&type=2\')"><div class="pic" _click="ViewMgr.gotoPage(\'tradePic\',\'itemid=${branch_id}&type=2\')"><img src="${pic_index}" alt="${branch_name}" /></div><div class="info ub-f1"><h2>${branch_name}</h2><div class="trade_like_text"><p class="ub-f1">${description}</p></div>${cb:distance}</div></div>',
activity:'<li class="ub" _click="ViewMgr.gotoPage(\'activityInfo\',\'itemid=${id}&type=3\')"><div class="coupon_pic"><img src="${pic}" alt="${title}" /></div><div class="coupon_info ub-f1"><h2>${title}</h2><div class="coupon_text ub"><p class="ub-f1">${description}</p><div class="comment_more"><img src="css/images/arrow.png" alt="更多" /></div></div></div></li>',attentionTrade:'<div class="trade_like ub" _click="ViewMgr.gotoPage(\'tradePage\',\'itemid=${branch_id}&type=2\')"><div class="pic" _click="ViewMgr.gotoPage(\'tradePic\',\'itemid=${branch_id}&type=2\')"><img src="${pic_index}" alt="${branch_name}" /></div><div class="info ub-f1"><h2>${branch_name}</h2><div class="trade_like_text"><p class="ub-f1">${description}</p></div></div></div>',
favoriteProduct:'<div class="new_list ub-f1" _click="ViewMgr.gotoPage(\'product\',\'itemid=${item_id}&type=1\')"><div class="new_list_img"><img src="${pic_index}" alt="${item_name}" /><p class="new_price">￥${price}</p></div></div>',tradePic:'<div class="new_list ub-f1" _click="Device.imageBrowser(\'${pic_url}\')"><div class="new_list_img"><img src="${pic_url}" alt="${pic_id}" /></div></div>',systemMsg:'<li><p>${content}</p><span class="sysem_time">${update_time}</span></li>'};
feedTemplate.tradePage=feedTemplate.product;
var pageFeedUrl={"new":"?r=api/itemCategory/list&ajax=1&callback=?",sale:"?r=api/item/list&ajax=1&callback=?&num=12",product:"?r=api/Comment/list&ajax=1&callback=?&num=1",commentList:"?r=api/Comment/list&ajax=1&callback=?&num=10",tradeList:"?r=/api/branch/list&ajax=1&callback=?",tradePage:"?r=api/Comment/list&ajax=1&callback=?&num=1",tradePic:"?r=api/branch/piclist&ajax=1&callback=?&num=30",activity:"?r=/api/action/list&ajax=1&callback=?&num=10",attentionTrade:"?r=api/userAttention/list&ajax=1&callback=?&num=10",favoriteProduct:"?r=api/userFavorite/list&ajax=1&callback=?&num=12",
systemMsg:"?r=api/message/list&ajax=1&callback=?&num=10"},Feed=function(a){this.destroy();extend(this,{index:0,isLoading:!1,isRefresh:!1,dataCount:0,totalPage:0,threeWrap:!1,isDestroyed:!1,autoLoad:!1,onAppend:!1,addParam:null,noDataStr:"暂无数据",addMoreStr:"点击或向上拖动加载更多",noMoreStr:"没有更多了",addingMoreStr:"正在加载..."},a);this.refresh()};Feed.init=function(a){WIN.myFeed&&myFeed.destroy();WIN.myFeed=new Feed(a);Mix.obs.subscribe("resize",function(){myFeed.refreshSize()})};
Feed.refresh=function(a){if(!WIN.myFeed)return!1;WIN.myFeed.refresh(a)};
Feed.prototype={reset:function(){this.isLoading=this.isRefresh=!1;typeof this.cb=="function"&&this.cb();if(this.autoLoad&&this.noMoreStr!=this.moreEl.innerHTML)this.moreEl.innerHTML=this.addMoreStr},destroy:function(){delete this.page;delete this.cont;delete this.onePageNum;delete this.cb;this.beforedestroy&&this.beforedestroy();this.isDestroyed=!0;this.loadXhr&&this.loadXhr.abort();delete this.loadXhr},refresh:function(a){if(!this.isRefresh){this.beforeRefersh&&this.beforeRefersh();this.index=0;
this.isRefresh=!0;this.isLoading=!1;this.loadXhr&&this.loadXhr.abort();if(this.autoLoad)this.moreEl=DOM.create("div",{innerHTML:this.addMoreStr,className:"feed_more"}),this.moreEl.setAttribute("_click","myFeed.loadMore()");this.loadMore(a)}},loadMoreSecc:function(a){var b=this,c;if(0!==a.errCode*1)b.reset(),toast(a.errStr);else{b.index++;if(b.isRefresh)b.cont.innerHTML="";b.dataCount=a.allcount||a.list&&a.list.length||0;b.totalPage=a.pagecount||0;b.seccEnd(a);c=a.list;if(["new","sale","tradePic",
"favoriteProduct"].has(b.page)){var d=[],f="new"==b.page?"pic":"tradePic"==b.page?"pic_url":"pic_index";$.each(c,function(a){d.push(a[f])});UserTools.preLoadResource(d,function(){b.fullFillFeed(c)})}else b.fullFillFeed(c)}},seccEnd:function(){switch(this.page){case "attentionTrade":var a=$("#attentionTrade_num");if(a&&this.dataCount)a.innerHTML=this.dataCount;break;case "favoriteProduct":if((a=$("#favoriteProduct_num"))&&this.dataCount)a.innerHTML=this.dataCount}},loadMore:function(a){if(!this.isLoading){this.isLoading=
!0;if(this.autoLoad)this.moreEl.innerHTML=this.addingMoreStr;if(!this.isRefresh&&typeof this.totalPage=="number"&&this.index>=this.totalPage){if(this.autoLoad)this.moreEl.innerHTML=this.noMoreStr,this.moreEl.removeAttribute("_click");this.reset();return!1}if(!a&&this.addParam)a=this.addParam;var b=this.getUrl(),a=this.setParams(a),b=StorMgr.siteUrl+b;this.sendRequest(b,a)}},sendRequest:function(a,b){var c=this;c.loadXhr=UserAction.sendAction(a,b,"get",function(a){c.loadMoreSecc(a)},function(){c.reset()})},
getUrl:function(){var a=pageFeedUrl[this.page];switch(this.page){case "product":case "commentList":case "tradePage":a+="&nid="+UserTools.getParamVal("itemid")+"&type="+UserTools.getParamVal("type");break;case "tradePic":a+="&branch="+UserTools.getParamVal("itemid");break;case "activity":UserTools.getParamVal("itemid")&&(a+="&branch="+UserTools.getParamVal("itemid"))}return a+"&sid="+StorMgr.sid},setParams:function(a){var b="page="+(this.index+1);a?b+="&"+a:"tradeList"==this.page&&(b+="&rang=10000"+
Mix.map.getParams());return b},fullFillFeed:function(a){if(this.isRefresh&&(!a||a.length==0))this.cont.innerHTML="<div style='color:#333;padding:1em;text-align:center'>"+this.noDataStr+"</div>",this.reset();else{this.reset();this.autoLoad&&$(".feed_more")&&this.cont.removeChild(this.moreEl);var b=a.length;if(!this.onePageNum)this.onePageNum=b;if(this.threeWrap)var c=DOM.create("div",{className:"ub"});for(var d=0;d<b;d++){var f=DOM.create("div");f.innerHTML=this.compileTmpl(a[d],d);if(this.threeWrap){d%
3==0&&(c=DOM.create("div",{className:"ub"}));for(var g=0,h=f.children.length;g<h;g++)c.appendChild(f.firstElementChild);if(d%3==2||d==b-1){if(d==b-1&&b%3!=0)for(var g=3-b%3,i=0;i<g;i++)h=DOM.create("div",{className:"new_list ub-f1",innerHTML:'<div class="new_list_img"></div>',style:{"border-color":"transparent"}}),c.appendChild(h);this.cont.appendChild(c);c.firstElementChild.offsetWidth>(c.offsetWidth-12)/3&&$.each($$(".new_list_img",c),function(a){a.style.width=(c.offsetWidth-24)/3+"px"})}}else{g=
0;for(h=f.children.length;g<h;g++)this.cont.appendChild(f.firstElementChild)}delete f}if(this.autoLoad&&(this.cont.appendChild(this.moreEl),this.index>=this.totalPage))this.moreEl.innerHTML=this.noMoreStr,this.moreEl.removeAttribute("_click");this.onAppend&&this.onAppend.call(this)}},refreshSize:function(){var a=this.cont.offsetWidth;$.each($$(".new_list_img",this.cont),function(b){b.style.width=(a-24)/3+"px"})},compileTmpl:function(a,b){var c=feedTemplate[this.page],d=this.onePageNum*(this.index-
1)+b+1,f="";"systemMsg"!=this.page&&(a=Mix.base.htmlEncodeObj(a));switch(this.page){case "tradeList":f=Mix.base.compiTpl(c,a,function(a,b){if(b[1]=="distance")return a.distance?'<div class="trade_removing">'+a.distance+"m以内</div>":""},d);break;default:f=Mix.base.compiTpl(c,a,null,d)}return f}};
